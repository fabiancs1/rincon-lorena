<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda â€” RincÃ³n de Lorena</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<style>
:root{--bg:#0d0810;--surface:#16101a;--surface2:#1e1525;--cream:#f5ede0;--muted:rgba(245,237,224,0.5);--rose:#d4789a;--deep-rose:#a0435a;--gold:#c9a84c;--soft-gold:rgba(201,168,76,0.12);--border:rgba(201,168,76,0.12);--border-rose:rgba(212,120,154,0.2);}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);font-family:'Cormorant Garamond',serif;color:var(--cream);min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(ellipse 60% 50% at 30% 70%,rgba(160,67,90,0.1) 0%,transparent 70%);}
.topbar{position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(13,8,16,0.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);}
.topbar-logo{font-family:'Playfair Display',serif;font-style:italic;color:var(--gold);font-size:1rem;text-decoration:none;}
.topbar-nav{display:flex;gap:2px;overflow-x:auto;}
.nav-link{color:var(--muted);font-size:0.78rem;padding:6px 12px;border-radius:20px;text-decoration:none;transition:all 0.2s;border:1px solid transparent;white-space:nowrap;}
.nav-link:hover{color:var(--cream);}
.nav-link.active{color:var(--gold);border-color:rgba(201,168,76,0.25);background:var(--soft-gold);}
.page-body{position:relative;z-index:1;max-width:860px;margin:0 auto;padding:40px 20px 80px;}
.page-header{margin-bottom:24px;}
.page-header h1{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,5vw,2.6rem);}
.page-header h1 em{color:var(--rose);font-style:italic;}

/* UPCOMING SPECIAL DATES */
.upcoming-strip{display:flex;gap:10px;overflow-x:auto;margin-bottom:24px;padding-bottom:4px;scrollbar-width:none;}
.upcoming-strip::-webkit-scrollbar{display:none;}
.upcoming-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px 18px;flex-shrink:0;min-width:150px;text-align:center;position:relative;overflow:hidden;}
.upcoming-card.special{border-color:rgba(201,168,76,0.35);background:linear-gradient(135deg,rgba(201,168,76,0.08),rgba(160,67,90,0.06));}
.upcoming-card.today-special{border-color:var(--rose);animation:glowPulse 2s ease-in-out infinite;}
@keyframes glowPulse{0%,100%{box-shadow:0 0 0 rgba(212,120,154,0);}50%{box-shadow:0 0 18px rgba(212,120,154,0.3);}}
.upcoming-card .up-days{font-family:'Playfair Display',serif;font-size:1.4rem;color:var(--gold);line-height:1;}
.upcoming-card .up-label{font-size:0.7rem;color:var(--muted);margin-top:2px;font-style:italic;}
.upcoming-card .up-name{font-size:0.82rem;color:var(--cream);margin-top:6px;font-style:italic;}

/* CALENDAR */
.cal-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;}
.cal-nav h2{font-family:'Playfair Display',serif;font-size:1.25rem;font-style:italic;color:var(--gold);}
.cal-btn{background:none;border:1px solid var(--border);color:var(--gold);width:34px;height:34px;border-radius:50%;cursor:pointer;font-size:1rem;transition:all 0.2s;display:flex;align-items:center;justify-content:center;}
.cal-btn:hover{background:var(--soft-gold);}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-bottom:28px;}
.cal-day-name{text-align:center;font-size:0.65rem;letter-spacing:0.1em;color:var(--muted);text-transform:uppercase;padding:8px 0;}
.cal-day{aspect-ratio:1;border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s;font-size:0.85rem;position:relative;border:1px solid transparent;}
.cal-day:hover:not(.empty){background:var(--surface);border-color:var(--border);}
.cal-day.today{background:rgba(212,120,154,0.15);border-color:var(--border-rose);color:var(--rose);font-weight:600;}
.cal-day.has-event::after{content:'';position:absolute;bottom:3px;left:50%;transform:translateX(-50%);width:4px;height:4px;border-radius:50%;background:var(--rose);}
.cal-day.special-date{background:rgba(201,168,76,0.1);border-color:rgba(201,168,76,0.3);color:var(--gold);}
.cal-day.special-date::before{content:'âœ¦';position:absolute;top:1px;right:3px;font-size:0.45rem;color:var(--gold);opacity:0.7;}
.cal-day.selected{background:var(--surface2);border-color:var(--rose);}
.cal-day.other-month{opacity:0.2;cursor:default;}
.cal-day.empty{cursor:default;}

/* LEGEND */
.cal-legend{display:flex;gap:16px;margin-bottom:18px;font-size:0.72rem;color:var(--muted);flex-wrap:wrap;}
.legend-item{display:flex;align-items:center;gap:6px;}
.legend-dot{width:10px;height:10px;border-radius:3px;}

/* EVENTS PANEL */
.events-panel{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:22px;}
.events-panel h3{font-family:'Playfair Display',serif;font-size:1rem;color:var(--cream);margin-bottom:14px;}
.events-panel h3 span{color:var(--rose);font-style:italic;}
.event-list{display:flex;flex-direction:column;gap:8px;margin-bottom:16px;min-height:36px;}
.event-item{background:var(--surface2);border:1px solid var(--border);border-radius:11px;padding:11px 14px;display:flex;align-items:center;gap:10px;}
.event-item.is-special{border-color:rgba(201,168,76,0.3);background:rgba(201,168,76,0.05);}
.event-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.event-text{flex:1;font-size:0.88rem;color:var(--cream);}
.event-del{background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.9rem;padding:3px;transition:color 0.2s;}
.event-del:hover{color:var(--rose);}
.event-empty{color:var(--muted);font-style:italic;font-size:0.85rem;padding:6px 0;}
.add-event{display:flex;gap:10px;flex-wrap:wrap;}
.add-event input{flex:1;min-width:160px;background:var(--surface2);border:1px solid var(--border);color:var(--cream);padding:9px 13px;border-radius:11px;font-family:'Cormorant Garamond',serif;font-size:0.92rem;outline:none;transition:border-color 0.2s;}
.add-event input::placeholder{color:var(--muted);}
.add-event input:focus{border-color:var(--border-rose);}
.add-event select{background:var(--surface2);border:1px solid var(--border);color:var(--cream);padding:9px 10px;border-radius:11px;font-family:'Cormorant Garamond',serif;font-size:0.88rem;outline:none;cursor:pointer;}
.btn-add{background:linear-gradient(135deg,var(--deep-rose),var(--rose));color:white;border:none;padding:9px 18px;border-radius:11px;font-family:'Cormorant Garamond',serif;font-size:0.92rem;cursor:pointer;transition:all 0.2s;white-space:nowrap;}
.btn-add:hover{transform:translateY(-1px);}

/* SPECIAL DATES SECTION â€” editable */
.special-section{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:22px;margin-top:24px;}
.special-section h3{font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:16px;color:var(--gold);}
.special-list{display:flex;flex-direction:column;gap:8px;margin-bottom:16px;}
.special-item{display:flex;align-items:center;gap:10px;background:var(--surface2);border-radius:11px;padding:10px 14px;}
.special-item-name{flex:1;font-size:0.88rem;}
.special-item-date{font-size:0.75rem;color:var(--gold);font-style:italic;}
.special-del{background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.85rem;transition:color 0.2s;}
.special-del:hover{color:var(--rose);}
.add-special{display:flex;gap:8px;flex-wrap:wrap;}
.add-special input{flex:1;min-width:130px;background:var(--surface2);border:1px solid var(--border);color:var(--cream);padding:9px 12px;border-radius:11px;font-family:'Cormorant Garamond',serif;font-size:0.9rem;outline:none;}
.add-special input::placeholder{color:var(--muted);}
.add-special input:focus{border-color:var(--border-rose);}
.add-special input[type="date"]{color-scheme:dark;}

@media(max-width:600px){.topbar-nav .nav-text{display:none;}.cal-day{font-size:0.75rem;border-radius:7px;}.add-event,.add-special{flex-direction:column;}}
</style>
</head>
<body>
<header class="topbar">
  <a href="index.html" class="topbar-logo">RincÃ³n de Lorena ğŸŒ¹</a>
  <nav class="topbar-nav">
    <a href="biblioteca.html" class="nav-link">ğŸ“š<span class="nav-text"> Libros</span></a>
    <a href="videos.html" class="nav-link">ğŸ¬<span class="nav-text"> Videos</span></a>
    <a href="musica.html" class="nav-link">ğŸµ<span class="nav-text"> MÃºsica</span></a>
    <a href="calendario.html" class="nav-link active">ğŸ“…<span class="nav-text"> Agenda</span></a>
    <a href="diario.html" class="nav-link">ğŸ’­<span class="nav-text"> Diario</span></a>
    <a href="album.html" class="nav-link">ğŸ–¼ï¸<span class="nav-text"> Ãlbum</span></a>
  </nav>
</header>
<div class="page-body">
  <div class="page-header">
    <h1>Tu <em>Agenda</em> ğŸ“…</h1>
  </div>

  <!-- UPCOMING SPECIAL DATES -->
  <div class="upcoming-strip" id="upcomingStrip"></div>

  <!-- CALENDAR -->
  <div class="cal-nav">
    <button class="cal-btn" onclick="changeMonth(-1)">â€¹</button>
    <h2 id="calTitle"></h2>
    <button class="cal-btn" onclick="changeMonth(1)">â€º</button>
  </div>

  <!-- LEGEND -->
  <div class="cal-legend">
    <div class="legend-item"><div class="legend-dot" style="background:rgba(212,120,154,0.5)"></div> Hoy</div>
    <div class="legend-item"><div class="legend-dot" style="background:rgba(201,168,76,0.4)"></div> Fecha especial</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--rose)"></div> Evento tuyo</div>
  </div>

  <div class="cal-grid" id="calGrid"></div>

  <!-- EVENTS PANEL -->
  <div class="events-panel">
    <h3>Eventos del <span id="selectedDateLabel">dÃ­a</span></h3>
    <div class="event-list" id="eventList"></div>
    <div class="add-event">
      <input type="text" id="eventInput" placeholder="Agregar evento..." maxlength="80">
      <select id="eventColor">
        <option value="#d4789a">ğŸŒ¸ Rosa</option>
        <option value="#c9a84c">âœ¨ Dorado</option>
        <option value="#7ab8d4">ğŸ’™ Azul</option>
        <option value="#7ad4a0">ğŸ’š Verde</option>
      </select>
      <button class="btn-add" onclick="addEvent()">+ Agregar</button>
    </div>
  </div>

  <!-- SPECIAL DATES MANAGER -->
  <div class="special-section">
    <h3>âœ¦ Fechas especiales</h3>
    <div class="special-list" id="specialList"></div>
    <div class="add-special">
      <input type="text" id="spName" placeholder="Ej: Nuestro aniversario..." maxlength="40">
      <input type="date" id="spDate">
      <button class="btn-add" onclick="addSpecial()">+ Agregar</button>
    </div>
  </div>
</div>

<script>
const MONTHS=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
const DAYS=['Dom','Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b'];
const today = new Date();
let viewYear = today.getFullYear();
let viewMonth = today.getMonth();
let selectedDate = toKey(today);

function toKey(d){ return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }

function getEvents(){ try{ return JSON.parse(localStorage.getItem('lorena_events')||'{}'); }catch{ return {}; } }
function saveEvents(e){ localStorage.setItem('lorena_events', JSON.stringify(e)); }

function getSpecials(){ try{ return JSON.parse(localStorage.getItem('lorena_specials')||'[]'); }catch{ return []; } }
function saveSpecials(s){ localStorage.setItem('lorena_specials', JSON.stringify(s)); }

// Build set of special MM-DD keys (recurring yearly) and YYYY-MM-DD (one-time)
function specialDaySet(){
  const specials = getSpecials();
  const set = new Set();
  specials.forEach(s => {
    const parts = s.date.split('-');
    // Add as MM-DD for yearly recurrence
    set.add(`${parts[1]}-${parts[2]}`);
    // Also add full date
    set.add(s.date);
  });
  return set;
}

function isSpecialDay(key){
  const set = specialDaySet();
  const mmdd = key.slice(5); // MM-DD
  return set.has(key) || set.has(mmdd);
}

function getSpecialName(key){
  const specials = getSpecials();
  const mmdd = key.slice(5);
  const match = specials.find(s => s.date === key || s.date.slice(5) === mmdd);
  return match ? match.name : null;
}

// â”€â”€ UPCOMING STRIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderUpcoming(){
  const specials = getSpecials();

  // Load relationship date from config
  let extraSpecials = [...specials];
  try{
    const r = await fetch('config.json?' + Date.now());
    const cfg = await r.json();
    if(cfg.fecha_inicio_relacion){
      extraSpecials.unshift({ name: 'ğŸ’‘ Aniversario', date: cfg.fecha_inicio_relacion.slice(5) });
    }
    if(cfg.fechas_especiales){
      extraSpecials = [...cfg.fechas_especiales, ...extraSpecials];
    }
  }catch(e){}

  const strip = document.getElementById('upcomingStrip');
  if(!extraSpecials.length){ strip.style.display='none'; return; }

  const cards = extraSpecials.map(s => {
    const parts = s.date.includes('-') ? s.date.split('-') : null;
    if(!parts) return '';
    // Yearly: find next occurrence
    const isYearly = parts.length === 2; // MM-DD
    let nextDate;
    if(isYearly){
      nextDate = new Date(today.getFullYear(), parseInt(parts[0])-1, parseInt(parts[1]));
      if(nextDate < today) nextDate = new Date(today.getFullYear()+1, parseInt(parts[0])-1, parseInt(parts[1]));
    } else {
      nextDate = new Date(parts[0], parseInt(parts[1])-1, parseInt(parts[2]));
    }
    const diffDays = Math.round((nextDate - today) / (1000*60*60*24));
    const isToday = diffDays === 0;
    const daysLabel = isToday ? 'Â¡HOY! ğŸ‰' : diffDays === 1 ? 'MaÃ±ana' : `${diffDays} dÃ­as`;
    return `<div class="upcoming-card${isSpecialDay(toKey(nextDate))?' special':''}${isToday?' today-special':''}">
      <div class="up-days">${daysLabel}</div>
      <div class="up-label">${nextDate.toLocaleDateString('es-ES',{day:'numeric',month:'short'})}</div>
      <div class="up-name">${s.name}</div>
    </div>`;
  }).filter(Boolean);

  strip.innerHTML = cards.join('') || '';
  if(!cards.length) strip.style.display = 'none';
}

// â”€â”€ CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildCal(){
  document.getElementById('calTitle').textContent = `${MONTHS[viewMonth]} ${viewYear}`;
  const grid = document.getElementById('calGrid');
  let html = DAYS.map(d=>`<div class="cal-day-name">${d}</div>`).join('');
  const first = new Date(viewYear, viewMonth, 1).getDay();
  const daysInMonth = new Date(viewYear, viewMonth+1, 0).getDate();
  const prevDays = new Date(viewYear, viewMonth, 0).getDate();
  const events = getEvents();
  const todayKey = toKey(today);

  for(let i=0;i<first;i++){
    html += `<div class="cal-day other-month empty">${prevDays-first+i+1}</div>`;
  }
  for(let d=1;d<=daysInMonth;d++){
    const key = `${viewYear}-${String(viewMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday = key === todayKey;
    const hasEv = events[key] && events[key].length > 0;
    const isSpec = isSpecialDay(key);
    const isSel = key === selectedDate;
    let cls = 'cal-day';
    if(isToday) cls += ' today';
    if(isSpec) cls += ' special-date';
    if(hasEv) cls += ' has-event';
    if(isSel) cls += ' selected';
    html += `<div class="${cls}" onclick="selectDay('${key}')">${d}</div>`;
  }
  const total = first + daysInMonth;
  const rem = (7 - total%7) % 7;
  for(let i=1;i<=rem;i++) html += `<div class="cal-day other-month empty">${i}</div>`;
  grid.innerHTML = html;
  renderEvents();
}

function selectDay(key){ selectedDate = key; buildCal(); }

function renderEvents(){
  const events = getEvents();
  const list = document.getElementById('eventList');
  const parts = selectedDate.split('-');
  document.getElementById('selectedDateLabel').textContent = `${parseInt(parts[2])} de ${MONTHS[parseInt(parts[1])-1]}`;
  const evs = events[selectedDate] || [];

  // Check if special date
  const specialName = getSpecialName(selectedDate);
  let html = '';
  if(specialName){
    html += `<div class="event-item is-special"><div class="event-dot" style="background:var(--gold)"></div><span class="event-text">âœ¦ ${specialName}</span></div>`;
  }
  if(!evs.length && !specialName){ list.innerHTML='<p class="event-empty">Sin eventos para este dÃ­a âœ¨</p>'; return; }
  html += evs.map((e,i)=>`<div class="event-item">
    <div class="event-dot" style="background:${e.color||'var(--rose)'}"></div>
    <span class="event-text">${e.text}</span>
    <button class="event-del" onclick="delEvent(${i})">âœ•</button>
  </div>`).join('');
  list.innerHTML = html;
}

function addEvent(){
  const inp = document.getElementById('eventInput');
  const txt = inp.value.trim(); if(!txt) return;
  const color = document.getElementById('eventColor').value;
  const events = getEvents();
  if(!events[selectedDate]) events[selectedDate] = [];
  events[selectedDate].push({text:txt, color});
  saveEvents(events);
  inp.value = '';
  buildCal();
}

function delEvent(i){
  const events = getEvents();
  if(events[selectedDate]){ events[selectedDate].splice(i,1); if(!events[selectedDate].length) delete events[selectedDate]; }
  saveEvents(events); buildCal();
}

function changeMonth(d){ viewMonth+=d; if(viewMonth>11){viewMonth=0;viewYear++;}else if(viewMonth<0){viewMonth=11;viewYear--;} buildCal(); }
document.getElementById('eventInput').addEventListener('keydown', e => { if(e.key==='Enter') addEvent(); });

// â”€â”€ SPECIAL DATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSpecials(){
  const specials = getSpecials();
  const list = document.getElementById('specialList');
  if(!specials.length){ list.innerHTML='<p style="color:var(--muted);font-style:italic;font-size:0.85rem;padding:6px 0">Agrega tus fechas especiales abajo âœ¦</p>'; return; }
  list.innerHTML = specials.map((s,i) => {
    const parts = s.date.split('-');
    const isYearly = parts.length === 2;
    const label = isYearly
      ? `cada ${new Date(2000,parseInt(parts[0])-1,parseInt(parts[1])).toLocaleDateString('es-ES',{day:'numeric',month:'long'})}`
      : new Date(parts[0],parseInt(parts[1])-1,parseInt(parts[2])).toLocaleDateString('es-ES',{day:'numeric',month:'long',year:'numeric'});
    return `<div class="special-item">
      <span style="font-size:1rem">âœ¦</span>
      <span class="special-item-name">${s.name}</span>
      <span class="special-item-date">${label}</span>
      <button class="special-del" onclick="delSpecial(${i})">âœ•</button>
    </div>`;
  }).join('');
}

function addSpecial(){
  const name = document.getElementById('spName').value.trim();
  const dateVal = document.getElementById('spDate').value;
  if(!name || !dateVal) return;
  // Store as MM-DD for yearly, or YYYY-MM-DD for one-time
  const parts = dateVal.split('-');
  const dateStored = parts[1] + '-' + parts[2]; // MM-DD = yearly
  const specials = getSpecials();
  specials.push({ name, date: dateStored });
  saveSpecials(specials);
  document.getElementById('spName').value = '';
  document.getElementById('spDate').value = '';
  renderSpecials();
  buildCal();
  renderUpcoming();
}

function delSpecial(i){
  const specials = getSpecials(); specials.splice(i,1); saveSpecials(specials);
  renderSpecials(); buildCal(); renderUpcoming();
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderUpcoming();
buildCal();
renderSpecials();
</script>
</body>
</html>