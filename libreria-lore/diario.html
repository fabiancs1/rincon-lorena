<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diario â€” RincÃ³n de Lorena</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap" rel="stylesheet">
<style>
:root{--bg:#0d0810;--surface:#16101a;--surface2:#1e1525;--cream:#f5ede0;--muted:rgba(245,237,224,0.5);--rose:#d4789a;--deep-rose:#a0435a;--gold:#c9a84c;--soft-gold:rgba(201,168,76,0.12);--border:rgba(201,168,76,0.12);--border-rose:rgba(212,120,154,0.2);}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);font-family:'Cormorant Garamond',serif;color:var(--cream);min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(ellipse 50% 60% at 70% 30%,rgba(90,60,160,0.1) 0%,transparent 70%);}

.topbar{position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(13,8,16,0.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);}
.topbar-logo{font-family:'Playfair Display',serif;font-style:italic;color:var(--gold);font-size:1rem;text-decoration:none;}
.topbar-nav{display:flex;gap:2px;overflow-x:auto;}
.nav-link{color:var(--muted);font-size:0.78rem;padding:6px 12px;border-radius:20px;text-decoration:none;transition:all 0.2s;border:1px solid transparent;white-space:nowrap;}
.nav-link:hover{color:var(--cream);}
.nav-link.active{color:var(--gold);border-color:rgba(201,168,76,0.25);background:var(--soft-gold);}

.page-body{position:relative;z-index:1;max-width:780px;margin:0 auto;padding:40px 20px 80px;}

/* â”€â”€ LOCK SCREEN â”€â”€ */
.lock-screen{text-align:center;padding:80px 20px;display:flex;flex-direction:column;align-items:center;gap:20px;}
.lock-icon{font-size:4rem;animation:float 3s ease-in-out infinite;}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-8px);}}
.lock-screen h2{font-family:'Playfair Display',serif;font-size:1.8rem;font-style:italic;}
.lock-screen p{color:var(--muted);font-style:italic;}
.pin-input{display:flex;gap:10px;justify-content:center;margin-top:8px;}
.pin-dot{width:52px;height:52px;background:var(--surface);border:1px solid var(--border);border-radius:14px;font-size:1.5rem;text-align:center;color:var(--cream);font-family:'Cormorant Garamond',serif;outline:none;transition:border-color 0.2s;}
.pin-dot:focus{border-color:var(--rose);}
.btn-unlock{background:linear-gradient(135deg,var(--deep-rose),var(--rose));color:white;border:none;padding:13px 36px;border-radius:30px;font-family:'Cormorant Garamond',serif;font-size:1.05rem;cursor:pointer;transition:all 0.25s;}
.btn-unlock:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(160,67,90,0.35);}
.lock-error{color:var(--rose);font-style:italic;font-size:0.9rem;display:none;}
.lock-hint{font-size:0.75rem;color:var(--muted);font-style:italic;}

/* â”€â”€ DIARY VIEW â”€â”€ */
.diary-view{display:none;}
.diary-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;flex-wrap:wrap;gap:12px;}
.diary-header h1{font-family:'Playfair Display',serif;font-size:clamp(1.6rem,4vw,2.2rem);}
.diary-header h1 em{color:var(--rose);font-style:italic;}
.header-btns{display:flex;gap:8px;flex-wrap:wrap;}
.btn-lock{background:none;border:1px solid var(--border);color:var(--muted);padding:8px 16px;border-radius:20px;font-family:'Cormorant Garamond',serif;font-size:0.82rem;cursor:pointer;transition:all 0.2s;}
.btn-lock:hover{color:var(--rose);border-color:var(--border-rose);}

/* â”€â”€ NEW ENTRY â”€â”€ */
.new-entry{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:24px;margin-bottom:28px;position:relative;overflow:hidden;}
.new-entry::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(to right,var(--deep-rose),var(--gold));border-radius:18px 18px 0 0;}
.mood-row{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;}
.mood-btn{background:none;border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-size:0.85rem;cursor:pointer;transition:all 0.2s;color:var(--muted);}
.mood-btn:hover{border-color:var(--border-rose);}
.mood-btn.selected{border-color:var(--rose);background:rgba(212,120,154,0.12);color:var(--cream);}
.entry-date-label{font-size:0.7rem;color:var(--gold);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:12px;}
.entry-title-input{width:100%;background:none;border:none;color:var(--cream);font-family:'Playfair Display',serif;font-size:1.2rem;font-style:italic;outline:none;margin-bottom:10px;}
.entry-title-input::placeholder{color:var(--muted);}
.entry-body-input{width:100%;background:none;border:none;color:rgba(245,237,224,0.85);font-family:'Cormorant Garamond',serif;font-size:1rem;line-height:1.85;outline:none;resize:none;min-height:100px;}
.entry-body-input::placeholder{color:var(--muted);}
.entry-actions{display:flex;justify-content:flex-end;margin-top:14px;border-top:1px solid var(--border);padding-top:14px;}
.btn-save{background:linear-gradient(135deg,var(--deep-rose),var(--rose));color:white;border:none;padding:10px 24px;border-radius:20px;font-family:'Cormorant Garamond',serif;font-size:0.95rem;cursor:pointer;transition:all 0.2s;}
.btn-save:hover{transform:translateY(-1px);}

/* â”€â”€ ENTRIES LIST â”€â”€ */
.entries-list{display:flex;flex-direction:column;gap:14px;}
.entry-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:16px;
  padding:20px 22px;
  cursor:pointer;
  transition:all 0.25s;
  position:relative;
  overflow:hidden;
}
.entry-card:hover{border-color:var(--border-rose);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.25);}
.entry-card::after{
  content:'Leer â†’';
  position:absolute;bottom:16px;right:18px;
  font-size:0.72rem;color:var(--rose);font-style:italic;
  opacity:0;transition:opacity 0.2s;
}
.entry-card:hover::after{opacity:1;}
.entry-card-top{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.entry-card-date{font-size:0.7rem;color:var(--gold);font-style:italic;}
.entry-mood{font-size:1rem;}
.entry-card-title{font-family:'Playfair Display',serif;font-size:1rem;color:var(--cream);margin-bottom:6px;}
.entry-card-preview{font-size:0.88rem;color:var(--muted);line-height:1.6;}
.entry-card-del{position:absolute;top:14px;right:14px;background:none;border:none;color:transparent;cursor:pointer;font-size:0.9rem;transition:color 0.2s;z-index:2;}
.entry-card:hover .entry-card-del{color:var(--muted);}
.entry-card-del:hover{color:var(--rose) !important;}
.empty-diary{text-align:center;padding:40px;color:var(--muted);font-style:italic;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAPER MODAL â€” la magia
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.paper-overlay{
  display:none;
  position:fixed;inset:0;
  background:rgba(5,2,8,0.88);
  backdrop-filter:blur(12px);
  z-index:300;
  align-items:center;justify-content:center;
  padding:20px;
}
.paper-overlay.active{display:flex;}

.paper-sheet{
  background:#fdf8f0;
  color:#2a1a0e;
  border-radius:3px;
  max-width:580px;
  width:100%;
  max-height:88vh;
  overflow-y:auto;
  position:relative;
  box-shadow:
    0 1px 1px rgba(0,0,0,0.15),
    2px 2px 8px rgba(0,0,0,0.2),
    6px 6px 20px rgba(0,0,0,0.25),
    0 30px 80px rgba(0,0,0,0.5);

  /* Paper texture */
  background-image:
    repeating-linear-gradient(
      0deg,
      transparent,
      transparent 31px,
      rgba(180,150,100,0.15) 31px,
      rgba(180,150,100,0.15) 32px
    );
  background-position: 0 52px;

  /* Fold animation */
  transform-origin: top center;
  animation: paperUnfold 0.55s cubic-bezier(0.34,1.28,0.64,1) forwards;
}

@keyframes paperUnfold{
  0%  { transform: scaleY(0.05) rotateX(60deg); opacity:0; }
  40% { transform: scaleY(1.04) rotateX(-4deg); opacity:1; }
  65% { transform: scaleY(0.98) rotateX(2deg); }
  100%{ transform: scaleY(1) rotateX(0deg); opacity:1; }
}

.paper-sheet.closing{
  animation: paperFold 0.35s cubic-bezier(0.55,0,1,0.45) forwards;
}
@keyframes paperFold{
  0%  { transform: scaleY(1) rotateX(0deg); opacity:1; }
  100%{ transform: scaleY(0.05) rotateX(60deg); opacity:0; }
}

/* Red margin line */
.paper-sheet::before{
  content:'';
  position:absolute;top:0;bottom:0;left:52px;
  width:1px;
  background:rgba(220,100,100,0.3);
  pointer-events:none;
  z-index:1;
}

/* Top binding holes */
.paper-holes{
  display:flex;gap:0;
  position:absolute;top:0;left:0;right:0;
  height:44px;
  align-items:center;
  justify-content:center;
  gap:60px;
  pointer-events:none;
  z-index:2;
}
.paper-hole{
  width:14px;height:14px;
  border-radius:50%;
  background:var(--bg);
  box-shadow:inset 0 1px 3px rgba(0,0,0,0.3);
}

.paper-content{
  padding: 48px 36px 36px 68px;
  position:relative;z-index:2;
  font-family:'Cormorant Garamond',serif;
}

.paper-header{
  margin-bottom:24px;
  padding-bottom:16px;
  border-bottom:1px solid rgba(160,120,80,0.2);
}
.paper-mood{font-size:1.8rem;margin-bottom:8px;}
.paper-date{
  font-size:0.75rem;
  color:#8a6a4a;
  letter-spacing:0.1em;
  text-transform:uppercase;
  margin-bottom:10px;
  font-style:italic;
}
.paper-title{
  font-family:'Playfair Display',serif;
  font-size:clamp(1.4rem,4vw,2rem);
  color:#1a0d05;
  font-style:italic;
  line-height:1.2;
}

.paper-body{
  font-size:1.05rem;
  line-height:2; /* matches ruled lines at 32px */
  color:#2a1a0e;
  white-space:pre-wrap;
  word-break:break-word;
}

/* Close button */
.paper-close{
  position:sticky;top:10px;
  float:right;
  background:rgba(42,26,14,0.08);
  border:1px solid rgba(160,120,80,0.3);
  color:#8a6a4a;
  width:32px;height:32px;
  border-radius:50%;
  cursor:pointer;
  font-size:1rem;
  display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;
  z-index:10;
  margin-bottom:8px;
}
.paper-close:hover{background:rgba(160,67,90,0.1);border-color:var(--rose);color:var(--rose);}

/* Decorative corner fold */
.paper-corner{
  position:absolute;bottom:0;right:0;
  width:28px;height:28px;
  background:linear-gradient(225deg,#e8dcc8 50%,transparent 50%);
  border-radius:0 0 3px 0;
  pointer-events:none;
}
.paper-corner::after{
  content:'';
  position:absolute;bottom:0;right:0;
  width:28px;height:28px;
  background:linear-gradient(225deg,rgba(150,100,50,0.2) 50%,transparent 50%);
}

@media(max-width:600px){
  .topbar-nav .nav-text{display:none;}
  .pin-dot{width:44px;height:44px;font-size:1.3rem;}
  .paper-content{padding:44px 20px 30px 52px;}
  .paper-sheet::before{left:42px;}
}
</style>
</head>
<body>
<header class="topbar">
  <a href="index.html" class="topbar-logo">RincÃ³n de Lorena ğŸŒ¹</a>
  <nav class="topbar-nav">
    <a href="biblioteca.html" class="nav-link">ğŸ“š<span class="nav-text"> Libros</span></a>
    <a href="videos.html" class="nav-link">ğŸ¬<span class="nav-text"> Videos</span></a>
    <a href="musica.html" class="nav-link">ğŸµ<span class="nav-text"> MÃºsica</span></a>
    <a href="calendario.html" class="nav-link">ğŸ“…<span class="nav-text"> Agenda</span></a>
    <a href="diario.html" class="nav-link active">ğŸ’­<span class="nav-text"> Diario</span></a>
    <a href="album.html" class="nav-link">ğŸ–¼ï¸<span class="nav-text"> Ãlbum</span></a>
  </nav>
</header>

<div class="page-body">

  <!-- LOCK -->
  <div class="lock-screen" id="lockScreen">
    <div class="lock-icon">ğŸ”</div>
    <h2>Diario <em style="color:var(--rose);font-style:italic">Privado</em></h2>
    <p>Este espacio es solo tuyo ğŸŒ¹</p>
    <div class="pin-input">
      <input type="password" maxlength="1" class="pin-dot" id="p0" oninput="nextPin(0)" inputmode="numeric">
      <input type="password" maxlength="1" class="pin-dot" id="p1" oninput="nextPin(1)" inputmode="numeric">
      <input type="password" maxlength="1" class="pin-dot" id="p2" oninput="nextPin(2)" inputmode="numeric">
      <input type="password" maxlength="1" class="pin-dot" id="p3" oninput="nextPin(3)" inputmode="numeric">
    </div>
    <p class="lock-error" id="lockError">PIN incorrecto, intenta de nuevo ğŸŒ¸</p>
    <button class="btn-unlock" onclick="tryUnlock()">Entrar ğŸŒ¹</button>
    <p class="lock-hint">PIN por defecto: 1234</p>
  </div>

  <!-- DIARY -->
  <div class="diary-view" id="diaryView">
    <div class="diary-header">
      <h1>Mi <em>Diario</em> ğŸ’­</h1>
      <div class="header-btns">
        <button class="btn-lock" onclick="changePIN()">ğŸ”‘ Cambiar PIN</button>
        <button class="btn-lock" onclick="lockDiary()">ğŸ”’ Cerrar</button>
      </div>
    </div>

    <!-- NEW ENTRY -->
    <div class="new-entry">
      <div class="entry-date-label" id="newEntryDate"></div>
      <div class="mood-row" id="moodRow">
        <span style="font-size:0.75rem;color:var(--muted);align-self:center;font-style:italic;">Â¿CÃ³mo te sientes?</span>
        <button class="mood-btn" data-mood="ğŸ˜Š Feliz"    onclick="selectMood(this)">ğŸ˜Š Feliz</button>
        <button class="mood-btn" data-mood="ğŸ¥° Enamorada" onclick="selectMood(this)">ğŸ¥° Enamorada</button>
        <button class="mood-btn" data-mood="ğŸ˜Œ En paz"   onclick="selectMood(this)">ğŸ˜Œ En paz</button>
        <button class="mood-btn" data-mood="ğŸ˜¢ Triste"   onclick="selectMood(this)">ğŸ˜¢ Triste</button>
        <button class="mood-btn" data-mood="ğŸ˜¤ Frustrada" onclick="selectMood(this)">ğŸ˜¤ Frustrada</button>
        <button class="mood-btn" data-mood="ğŸ¤” Pensativa" onclick="selectMood(this)">ğŸ¤” Pensativa</button>
      </div>
      <input type="text" class="entry-title-input" id="entryTitle" placeholder="TÃ­tulo de tu entrada...">
      <textarea class="entry-body-input" id="entryBody" placeholder="Â¿CÃ³mo te sientes hoy? Escribe lo que quieras aquÃ­, nadie mÃ¡s lo leerÃ¡..." rows="5"></textarea>
      <div class="entry-actions">
        <button class="btn-save" onclick="saveEntry()">Guardar entrada âœ¨</button>
      </div>
    </div>

    <div class="entries-list" id="entriesList"></div>
  </div>
</div>

<!-- PAPER MODAL -->
<div class="paper-overlay" id="paperOverlay">
  <div class="paper-sheet" id="paperSheet">
    <button class="paper-close" onclick="closePaper()">âœ•</button>
    <div class="paper-holes">
      <div class="paper-hole"></div>
      <div class="paper-hole"></div>
      <div class="paper-hole"></div>
    </div>
    <div class="paper-content">
      <div class="paper-header">
        <div class="paper-mood" id="paperMood"></div>
        <div class="paper-date" id="paperDate"></div>
        <div class="paper-title" id="paperTitle"></div>
      </div>
      <div class="paper-body" id="paperBody"></div>
    </div>
    <div class="paper-corner"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyA2YJXgAZAjOVqZ3eeTiMa9kCKaut_cA2w",
  authDomain: "lore-basedatos.firebaseapp.com",
  databaseURL: "https://lore-basedatos-default-rtdb.firebaseio.com",
  projectId: "lore-basedatos",
  storageBucket: "lore-basedatos.firebasestorage.app",
  messagingSenderId: "348470598297",
  appId: "1:348470598297:web:4634471f293f24a64fb608"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const DEFAULT_PIN = '1234';
let selectedMood = '';
let _entries = [];

function getPin() { return localStorage.getItem('lorena_diary_pin') || DEFAULT_PIN; }

async function loadEntries() {
  try {
    const snap = await get(ref(db, 'diario/entries'));
    _entries = snap.val() || [];
  } catch(e) {
    console.error('Error cargando diario:', e);
    _entries = [];
  }
}

function getEntries() { return _entries; }

async function saveEntries(entries) {
  _entries = entries;
  try {
    await set(ref(db, 'diario/entries'), entries);
  } catch(e) {
    console.error('Error guardando diario:', e);
    alert('Error al guardar. Verifica tu conexiÃ³n.');
  }
}

// â”€â”€ PIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.nextPin = function(i){ const v=document.getElementById(`p${i}`).value; if(v&&i<3) document.getElementById(`p${i+1}`).focus(); }
window.tryUnlock = function(){
  const pin=[0,1,2,3].map(i=>document.getElementById(`p${i}`).value).join('');
  if(pin===getPin()){ unlock(); }
  else{
    document.getElementById('lockError').style.display='block';
    [0,1,2,3].forEach(i=>document.getElementById(`p${i}`).value='');
    document.getElementById('p0').focus();
  }
}
document.addEventListener('keydown', e=>{
  if(e.key==='Enter' && document.getElementById('lockScreen').style.display!=='none') tryUnlock();
});

window.unlock = async function(){
  document.getElementById('lockScreen').style.display='none';
  document.getElementById('diaryView').style.display='block';
  const now=new Date();
  document.getElementById('newEntryDate').textContent=now.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
  document.getElementById('entriesList').innerHTML='<div class="empty-diary">Cargando entradas... ğŸŒ¸</div>';
  await loadEntries();
  renderEntries();
}
window.lockDiary = function(){
  document.getElementById('lockScreen').style.display='flex';
  document.getElementById('diaryView').style.display='none';
  [0,1,2,3].forEach(i=>document.getElementById(`p${i}`).value='');
  document.getElementById('lockError').style.display='none';
}
window.changePIN = function(){
  const np=prompt('Nuevo PIN (4 dÃ­gitos):');
  if(np&&/^\d{4}$/.test(np)){ localStorage.setItem('lorena_diary_pin',np); alert('PIN actualizado ğŸŒ¹'); }
  else if(np){ alert('El PIN debe ser exactamente 4 nÃºmeros.'); }
}

// â”€â”€ MOOD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.selectMood = function(btn){
  document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  selectedMood = btn.dataset.mood;
}

// â”€â”€ SAVE ENTRY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.saveEntry = async function(){
  const title=document.getElementById('entryTitle').value.trim();
  const body=document.getElementById('entryBody').value.trim();
  if(!body) return;
  const btn = document.querySelector('.btn-save');
  if(btn) { btn.textContent='Guardando... ğŸ’¾'; btn.disabled=true; }
  const entries=getEntries();
  entries.unshift({ title:title||'Sin tÃ­tulo', body, mood:selectedMood, date:new Date().toISOString() });
  await saveEntries(entries);
  document.getElementById('entryTitle').value='';
  document.getElementById('entryBody').value='';
  document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('selected'));
  selectedMood='';
  if(btn) { btn.textContent='Guardar entrada âœ¨'; btn.disabled=false; }
  renderEntries();
}

// â”€â”€ RENDER LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderEntries(){
  const entries=getEntries();
  const list=document.getElementById('entriesList');
  if(!entries.length){ list.innerHTML='<div class="empty-diary">AÃºn no hay entradas. Â¡Empieza a escribir hoy! âœ¨</div>'; return; }
  list.innerHTML=entries.map((e,i)=>{
    const d=new Date(e.date);
    const dateStr=d.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
    const preview=e.body.substring(0,110)+(e.body.length>110?'...':'');
    const moodEmoji = e.mood ? e.mood.split(' ')[0] : 'ğŸ’­';
    return `<div class="entry-card" onclick="openPaper(${i})">
      <button class="entry-card-del" onclick="event.stopPropagation();deleteEntry(${i})">âœ•</button>
      <div class="entry-card-top">
        <span class="entry-mood">${moodEmoji}</span>
        <span class="entry-card-date">ğŸ“… ${dateStr}</span>
      </div>
      <h3 class="entry-card-title">${e.title}</h3>
      <p class="entry-card-preview">${preview}</p>
    </div>`;
  }).join('');
}

window.deleteEntry = async function(i){
  if(!confirm('Â¿Eliminar esta entrada?')) return;
  const entries=getEntries(); entries.splice(i,1); await saveEntries(entries); renderEntries();
}

// â”€â”€ PAPER MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openPaper = function(i){
  const entries=getEntries();
  const e=entries[i];
  const d=new Date(e.date);
  const dateStr=d.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long',year:'numeric'});

  document.getElementById('paperMood').textContent  = e.mood || '';
  document.getElementById('paperDate').textContent  = dateStr;
  document.getElementById('paperTitle').textContent = e.title;
  document.getElementById('paperBody').textContent  = e.body;

  // Reset animation
  const sheet=document.getElementById('paperSheet');
  sheet.classList.remove('closing');
  sheet.style.animation='none';
  sheet.getBoundingClientRect(); // reflow
  sheet.style.animation='';

  document.getElementById('paperOverlay').classList.add('active');
  document.body.style.overflow='hidden';
}

window.closePaper = function(){
  const sheet=document.getElementById('paperSheet');
  sheet.classList.add('closing');
  setTimeout(()=>{
    document.getElementById('paperOverlay').classList.remove('active');
    document.body.style.overflow='';
  }, 340);
}

// Close on overlay click
document.getElementById('paperOverlay').addEventListener('click', e=>{
  if(e.target===document.getElementById('paperOverlay')) closePaper();
});
document.addEventListener('keydown', e=>{
  if(e.key==='Escape' && document.getElementById('paperOverlay').classList.contains('active')) closePaper();
});
</script>
</body>
</html>