<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>√Ålbum ‚Äî Rinc√≥n de Lorena</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<style>
:root{--bg:#0d0810;--surface:#16101a;--surface2:#1e1525;--cream:#f5ede0;--muted:rgba(245,237,224,0.5);--rose:#d4789a;--deep-rose:#a0435a;--gold:#c9a84c;--soft-gold:rgba(201,168,76,0.12);--border:rgba(201,168,76,0.12);--border-rose:rgba(212,120,154,0.2);}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);font-family:'Cormorant Garamond',serif;color:var(--cream);min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(ellipse 60% 50% at 80% 80%,rgba(160,67,90,0.1) 0%,transparent 70%);}
.topbar{position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(13,8,16,0.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);}
.topbar-logo{font-family:'Playfair Display',serif;font-style:italic;color:var(--gold);font-size:1rem;text-decoration:none;}
.topbar-nav{display:flex;gap:2px;overflow-x:auto;}
.nav-link{color:var(--muted);font-size:0.78rem;padding:6px 12px;border-radius:20px;text-decoration:none;transition:all 0.2s;border:1px solid transparent;white-space:nowrap;}
.nav-link:hover{color:var(--cream);}
.nav-link.active{color:var(--gold);border-color:rgba(201,168,76,0.25);background:var(--soft-gold);}
.page-body{position:relative;z-index:1;max-width:1000px;margin:0 auto;padding:40px 20px 80px;}
.page-header{margin-bottom:24px;}
.page-header h1{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,5vw,2.6rem);}
.page-header h1 em{color:var(--rose);font-style:italic;}

/* ALBUMS TABS */
.albums-bar{display:flex;align-items:center;gap:8px;margin-bottom:24px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none;}
.albums-bar::-webkit-scrollbar{display:none;}
.album-tab{background:var(--surface);border:1px solid var(--border);color:var(--muted);padding:8px 18px;border-radius:22px;font-family:'Cormorant Garamond',serif;font-size:0.85rem;cursor:pointer;transition:all 0.2s;white-space:nowrap;flex-shrink:0;}
.album-tab:hover{color:var(--cream);}
.album-tab.active{background:var(--soft-gold);border-color:rgba(201,168,76,0.35);color:var(--gold);}
.album-tab .count{font-size:0.7rem;opacity:0.6;margin-left:4px;}
.btn-new-album{background:none;border:1px dashed rgba(201,168,76,0.3);color:var(--muted);padding:8px 14px;border-radius:22px;font-family:'Cormorant Garamond',serif;font-size:0.82rem;cursor:pointer;transition:all 0.2s;white-space:nowrap;flex-shrink:0;}
.btn-new-album:hover{border-color:var(--gold);color:var(--gold);}

/* UPLOAD */
.upload-zone{border:2px dashed rgba(201,168,76,0.2);border-radius:18px;padding:28px;text-align:center;cursor:pointer;transition:all 0.3s;margin-bottom:24px;background:rgba(201,168,76,0.02);}
.upload-zone:hover,.upload-zone.drag-over{border-color:var(--rose);background:rgba(212,120,154,0.04);}
.upload-zone .uz-icon{font-size:2rem;margin-bottom:8px;}
.upload-zone p{color:var(--muted);font-style:italic;font-size:0.9rem;}
.upload-zone span{color:var(--gold);font-size:0.75rem;}

/* PHOTO GRID */
.photo-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:12px;}
.photo-item{position:relative;border-radius:12px;overflow:hidden;cursor:pointer;aspect-ratio:1;background:var(--surface);transition:transform 0.25s;}
.photo-item:hover{transform:scale(1.02);}
.photo-item img{width:100%;height:100%;object-fit:cover;display:block;}
.photo-del{position:absolute;top:7px;right:7px;background:rgba(0,0,0,0.65);color:white;border:none;width:26px;height:26px;border-radius:50%;cursor:pointer;font-size:0.7rem;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.2s;backdrop-filter:blur(4px);}
.photo-item:hover .photo-del{opacity:1;}
.photo-caption{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(0,0,0,0.7));padding:12px 10px 7px;font-size:0.75rem;color:rgba(255,255,255,0.85);font-style:italic;}
.empty-state{text-align:center;padding:50px 20px;color:var(--muted);}
.empty-state .icon{font-size:2.8rem;margin-bottom:12px;opacity:0.4;}

/* LIGHTBOX */
.lightbox{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.96);z-index:300;align-items:center;justify-content:center;padding:20px;}
.lightbox.active{display:flex;}
.lightbox-img{max-width:90vw;max-height:85vh;object-fit:contain;border-radius:6px;}
.lightbox-close{position:fixed;top:18px;right:22px;background:none;border:none;color:rgba(255,255,255,0.6);font-size:1.5rem;cursor:pointer;}
.lightbox-close:hover{color:white;}
.lightbox-nav{position:fixed;top:50%;transform:translateY(-50%);background:rgba(255,255,255,0.08);border:none;color:white;width:42px;height:42px;border-radius:50%;cursor:pointer;font-size:1.3rem;backdrop-filter:blur(4px);transition:background 0.2s;display:flex;align-items:center;justify-content:center;}
.lightbox-nav:hover{background:rgba(255,255,255,0.18);}
.lb-prev{left:14px;}.lb-next{right:14px;}
.lightbox-caption{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);color:rgba(255,255,255,0.55);font-style:italic;font-size:0.88rem;text-align:center;}

/* CAPTION MODAL */
.cap-overlay{display:none;position:fixed;inset:0;background:rgba(5,2,8,0.85);backdrop-filter:blur(10px);z-index:400;align-items:center;justify-content:center;padding:20px;}
.cap-overlay.active{display:flex;}
.cap-modal{background:var(--surface);border:1px solid var(--border-rose);border-radius:20px;padding:28px 24px;max-width:400px;width:100%;}
.cap-modal h3{font-family:'Playfair Display',serif;margin-bottom:16px;font-style:italic;font-size:1.1rem;}
.cap-modal input,.cap-modal select{width:100%;background:var(--surface2);border:1px solid var(--border);color:var(--cream);padding:11px 14px;border-radius:12px;font-family:'Cormorant Garamond',serif;font-size:0.95rem;outline:none;margin-bottom:12px;transition:border-color 0.2s;}
.cap-modal input::placeholder{color:var(--muted);}
.cap-modal input:focus,.cap-modal select:focus{border-color:var(--border-rose);}
.cap-modal select option{background:var(--surface2);}
.cap-btns{display:flex;gap:10px;justify-content:flex-end;margin-top:4px;}
.btn-confirm{background:linear-gradient(135deg,var(--deep-rose),var(--rose));color:white;border:none;padding:10px 22px;border-radius:20px;font-family:'Cormorant Garamond',serif;font-size:0.92rem;cursor:pointer;}
.btn-skip{background:none;border:1px solid var(--border);color:var(--muted);padding:10px 18px;border-radius:20px;font-family:'Cormorant Garamond',serif;font-size:0.92rem;cursor:pointer;}

/* NEW ALBUM MODAL */
.album-modal{background:var(--surface);border:1px solid var(--border-rose);border-radius:20px;padding:28px 24px;max-width:380px;width:100%;}
.album-modal h3{font-family:'Playfair Display',serif;margin-bottom:16px;font-style:italic;font-size:1.1rem;}
.album-modal input{width:100%;background:var(--surface2);border:1px solid var(--border);color:var(--cream);padding:11px 14px;border-radius:12px;font-family:'Cormorant Garamond',serif;font-size:0.95rem;outline:none;margin-bottom:12px;}
.album-modal input::placeholder{color:var(--muted);}
.album-modal input:focus{border-color:var(--border-rose);}

.photo-count{color:var(--muted);font-size:0.8rem;font-style:italic;margin-left:auto;}
@media(max-width:600px){.topbar-nav .nav-text{display:none;}.photo-grid{grid-template-columns:repeat(auto-fill,minmax(130px,1fr));}}
</style>
</head>
<body>
<header class="topbar">
  <a href="index.html" class="topbar-logo">Rinc√≥n de Lorena üåπ</a>
  <nav class="topbar-nav">
    <a href="biblioteca.html" class="nav-link">üìö<span class="nav-text"> Libros</span></a>
    <a href="videos.html" class="nav-link">üé¨<span class="nav-text"> Videos</span></a>
    <a href="musica.html" class="nav-link">üéµ<span class="nav-text"> M√∫sica</span></a>
    <a href="calendario.html" class="nav-link">üìÖ<span class="nav-text"> Agenda</span></a>
    <a href="diario.html" class="nav-link">üí≠<span class="nav-text"> Diario</span></a>
    <a href="album.html" class="nav-link active">üñºÔ∏è<span class="nav-text"> √Ålbum</span></a>
  </nav>
</header>
<div class="page-body">
  <div class="page-header">
    <h1>Tu <em>√Ålbum</em> üñºÔ∏è</h1>
  </div>

  <!-- ALBUMS BAR -->
  <div class="albums-bar" id="albumsBar"></div>

  <!-- UPLOAD -->
  <div class="upload-zone" id="uploadZone" onclick="document.getElementById('photoInput').click()">
    <div class="uz-icon">üì∏</div>
    <p>Toca aqu√≠ para agregar fotos</p>
    <span>Desde tu celular o computador</span>
  </div>
  <input type="file" id="photoInput" accept="image/*" multiple style="display:none" onchange="handleFiles(event)">

  <div class="photo-grid" id="photoGrid"></div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox">
  <button class="lightbox-close" onclick="closeLB()">‚úï</button>
  <button class="lightbox-nav lb-prev" onclick="lbNav(-1)">‚Äπ</button>
  <img class="lightbox-img" id="lbImg" src="" alt="">
  <button class="lightbox-nav lb-next" onclick="lbNav(1)">‚Ä∫</button>
  <span class="lightbox-caption" id="lbCaption"></span>
</div>

<!-- CAPTION MODAL -->
<div class="cap-overlay" id="capOverlay">
  <div class="cap-modal">
    <h3>¬øT√≠tulo para esta foto? üå∏</h3>
    <input type="text" id="capInput" placeholder="Ej: Mi momento favorito..." maxlength="60">
    <select id="capAlbum"></select>
    <div class="cap-btns">
      <button class="btn-skip" onclick="savePhoto('')">Sin t√≠tulo</button>
      <button class="btn-confirm" onclick="savePhoto(document.getElementById('capInput').value)">Guardar ‚ú®</button>
    </div>
  </div>
</div>

<!-- NEW ALBUM MODAL -->
<div class="cap-overlay" id="albumOverlay">
  <div class="album-modal">
    <h3>Nuevo √°lbum üìÅ</h3>
    <input type="text" id="albumNameInput" placeholder="Nombre del √°lbum..." maxlength="30">
    <div class="cap-btns">
      <button class="btn-skip" onclick="closeAlbumModal()">Cancelar</button>
      <button class="btn-confirm" onclick="createAlbum()">Crear ‚ú®</button>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DEFAULT_ALBUMS = ['Todas', 'Favoritas', 'Nosotros'];
let photos = [];
let albums = [];
let currentAlbum = 'Todas';
let pendingPhoto = null;
let lbIndex = 0;
let lbPhotos = [];

function loadData() {
  try { photos = JSON.parse(localStorage.getItem('lorena_album2') || '[]'); } catch { photos = []; }
  try { albums = JSON.parse(localStorage.getItem('lorena_albums') || 'null') || [...DEFAULT_ALBUMS]; } catch { albums = [...DEFAULT_ALBUMS]; }
}
function saveData() {
  localStorage.setItem('lorena_album2', JSON.stringify(photos));
  localStorage.setItem('lorena_albums', JSON.stringify(albums));
}

// ‚îÄ‚îÄ ALBUMS BAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAlbumsBar() {
  const bar = document.getElementById('albumsBar');
  bar.innerHTML = albums.map(a => {
    const cnt = a === 'Todas' ? photos.length : photos.filter(p => p.album === a).length;
    return `<button class="album-tab${currentAlbum===a?' active':''}" onclick="selectAlbum('${a}')">${a} <span class="count">${cnt}</span></button>`;
  }).join('') + `<button class="btn-new-album" onclick="openAlbumModal()">+ √Ålbum</button>`;
}

function selectAlbum(name) {
  currentAlbum = name;
  renderAlbumsBar();
  renderGrid();
}

// ‚îÄ‚îÄ GRID ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderGrid() {
  const grid = document.getElementById('photoGrid');
  const filtered = currentAlbum === 'Todas' ? photos : photos.filter(p => p.album === currentAlbum);
  if (!filtered.length) {
    grid.innerHTML = `<div class="empty-state"><div class="icon">üì∑</div><p>${currentAlbum === 'Todas' ? 'A√∫n no hay fotos. ¬°Agrega tu primera!' : 'Este √°lbum est√° vac√≠o.'}</p></div>`;
    return;
  }
  lbPhotos = filtered;
  grid.innerHTML = filtered.map((p, i) => `
    <div class="photo-item" onclick="openLB(${i})">
      <img src="${p.src}" alt="${p.caption||''}">
      ${p.caption ? `<div class="photo-caption">${p.caption}</div>` : ''}
      <button class="photo-del" onclick="event.stopPropagation();deletePhoto('${p.id}')">‚úï</button>
    </div>`).join('');
}

// ‚îÄ‚îÄ UPLOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleFiles(e) {
  const files = [...e.target.files];
  if (!files.length) return;
  processNext(files, 0);
  e.target.value = '';
}

function processNext(files, i) {
  if (i >= files.length) return;
  const reader = new FileReader();
  reader.onload = ev => {
    pendingPhoto = { src: ev.target.result, caption: '', album: currentAlbum === 'Todas' ? 'Todas' : currentAlbum, date: new Date().toISOString(), id: Date.now() + '_' + i };
    // Fill album select
    const sel = document.getElementById('capAlbum');
    sel.innerHTML = albums.filter(a => a !== 'Todas').map(a => `<option value="${a}"${pendingPhoto.album===a?' selected':''}>${a}</option>`).join('');
    document.getElementById('capInput').value = '';
    document.getElementById('capOverlay').classList.add('active');
    document.getElementById('capInput').focus();
    window._pendingNext = () => processNext(files, i + 1);
  };
  reader.readAsDataURL(files[i]);
}

function savePhoto(caption) {
  if (!pendingPhoto) return;
  pendingPhoto.caption = caption.trim();
  const selAlbum = document.getElementById('capAlbum').value;
  pendingPhoto.album = selAlbum || 'Sin categor√≠a';
  photos.unshift(pendingPhoto);
  saveData();
  renderAlbumsBar();
  renderGrid();
  pendingPhoto = null;
  document.getElementById('capOverlay').classList.remove('active');
  if (window._pendingNext) { window._pendingNext(); window._pendingNext = null; }
}

document.getElementById('capInput').addEventListener('keydown', e => { if (e.key === 'Enter') savePhoto(document.getElementById('capInput').value); });

function deletePhoto(id) {
  if (!confirm('¬øEliminar esta foto?')) return;
  photos = photos.filter(p => p.id != id);
  saveData(); renderAlbumsBar(); renderGrid();
}

// ‚îÄ‚îÄ ALBUM MANAGEMENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openAlbumModal() { document.getElementById('albumNameInput').value = ''; document.getElementById('albumOverlay').classList.add('active'); document.getElementById('albumNameInput').focus(); }
function closeAlbumModal() { document.getElementById('albumOverlay').classList.remove('active'); }
function createAlbum() {
  const name = document.getElementById('albumNameInput').value.trim();
  if (!name) return;
  if (!albums.includes(name)) { albums.push(name); saveData(); }
  closeAlbumModal();
  selectAlbum(name);
}
document.getElementById('albumNameInput').addEventListener('keydown', e => { if (e.key === 'Enter') createAlbum(); });

// ‚îÄ‚îÄ LIGHTBOX ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openLB(i) { lbIndex = i; updateLB(); document.getElementById('lightbox').classList.add('active'); }
function closeLB() { document.getElementById('lightbox').classList.remove('active'); }
function lbNav(d) { lbIndex = (lbIndex + d + lbPhotos.length) % lbPhotos.length; updateLB(); }
function updateLB() {
  document.getElementById('lbImg').src = lbPhotos[lbIndex].src;
  const alb = lbPhotos[lbIndex].album !== 'Todas' ? ` ¬∑ ${lbPhotos[lbIndex].album}` : '';
  document.getElementById('lbCaption').textContent = (lbPhotos[lbIndex].caption || '') + alb;
}
document.getElementById('lightbox').addEventListener('click', e => { if (e.target === document.getElementById('lightbox')) closeLB(); });
document.addEventListener('keydown', e => {
  if (!document.getElementById('lightbox').classList.contains('active')) return;
  if (e.key === 'ArrowLeft') lbNav(-1);
  if (e.key === 'ArrowRight') lbNav(1);
  if (e.key === 'Escape') closeLB();
});

// Drag & drop
const uz = document.getElementById('uploadZone');
uz.addEventListener('dragover', e => { e.preventDefault(); uz.classList.add('drag-over'); });
uz.addEventListener('dragleave', () => uz.classList.remove('drag-over'));
uz.addEventListener('drop', e => { e.preventDefault(); uz.classList.remove('drag-over'); const files=[...e.dataTransfer.files].filter(f=>f.type.startsWith('image/')); if(files.length) processNext(files,0); });

loadData();
renderAlbumsBar();
renderGrid();
</script>
</body>
</html>