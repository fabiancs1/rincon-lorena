<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diario â€” RincÃ³n de Lorena</title>
<link rel="stylesheet" href="lore.css">
<style>
/* â”€â”€ LOCK SCREEN â”€â”€ */
.lock-wrap {
  min-height: calc(100vh - 56px);
  display: flex; align-items: center; justify-content: center;
  padding: 40px 20px;
}
.lock-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r-xl);
  padding: 52px 40px;
  text-align: center; max-width: 380px; width: 100%;
  box-shadow: var(--shadow-lg);
  animation: scaleIn 0.5s cubic-bezier(0.34,1.4,0.64,1);
}
.lock-icon {
  font-size: 3.5rem;
  animation: float 3s ease-in-out infinite;
  display: block; margin-bottom: 20px;
  filter: drop-shadow(0 0 20px rgba(200,96,127,0.3));
}
@keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
.lock-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.7rem; font-style: italic; margin-bottom: 6px;
}
.lock-sub { color: var(--muted); font-style: italic; font-size: 0.88rem; margin-bottom: 28px; }

.pin-row {
  display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;
}
.pin-dot {
  width: 54px; height: 54px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--r-md);
  font-size: 1.5rem; text-align: center;
  color: var(--cream);
  font-family: 'Cormorant Garamond', serif;
  outline: none; transition: border-color 0.2s, box-shadow 0.2s;
}
.pin-dot:focus {
  border-color: var(--rose);
  box-shadow: 0 0 0 3px rgba(200,96,127,0.1);
}
.pin-error {
  color: var(--rose2); font-style: italic;
  font-size: 0.82rem; margin-bottom: 16px;
  display: none;
}
.pin-hint { font-size: 0.68rem; color: var(--muted2); font-style: italic; margin-top: 16px; }

/* â”€â”€ DIARY LAYOUT â”€â”€ */
.diary-wrap { display: none; }
.diary-header {
  display: flex; align-items: flex-end;
  justify-content: space-between; flex-wrap: wrap;
  gap: 14px; margin-bottom: 36px;
}
.diary-actions { display: flex; gap: 8px; flex-wrap: wrap; }

/* â”€â”€ NEW ENTRY â”€â”€ */
.new-entry {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r-xl);
  padding: 28px; margin-bottom: 36px;
  box-shadow: var(--shadow);
  transition: border-color 0.25s;
}
.new-entry:focus-within { border-color: var(--border-rose); }
.entry-dateline {
  font-size: 0.66rem; letter-spacing: 0.18em;
  text-transform: uppercase; color: var(--gold2);
  margin-bottom: 16px;
  display: flex; align-items: center; gap: 10px;
}
.entry-dateline::after {
  content: ''; flex: 1; height: 1px;
  background: linear-gradient(90deg, var(--border2), transparent);
}
.entry-title-in {
  width: 100%; background: none; border: none;
  color: var(--cream);
  font-family: 'Playfair Display', serif;
  font-size: 1.25rem; font-style: italic;
  outline: none; margin-bottom: 12px;
}
.entry-title-in::placeholder { color: var(--muted2); }
.entry-body-in {
  width: 100%; background: none; border: none;
  color: rgba(240,230,211,0.82);
  font-family: 'EB Garamond', serif;
  font-size: 1rem; line-height: 1.85;
  outline: none; resize: none; min-height: 110px;
}
.entry-body-in::placeholder { color: var(--muted2); }

.entry-moods {
  display: flex; gap: 6px; margin: 14px 0;
  flex-wrap: wrap;
}
.mood-btn {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: 20px; padding: 5px 12px;
  font-size: 0.75rem; color: var(--muted);
  cursor: pointer; transition: all 0.2s;
  font-family: 'Cormorant Garamond', serif;
}
.mood-btn:hover { border-color: var(--border-rose); color: var(--cream); }
.mood-btn.selected {
  background: rgba(200,96,127,0.12);
  border-color: var(--border-rose);
  color: var(--rose2);
}

.entry-foot {
  display: flex; justify-content: flex-end;
  padding-top: 16px; margin-top: 4px;
  border-top: 1px solid var(--border2);
}

/* â”€â”€ ENTRIES â”€â”€ */
.entries-list { display: flex; flex-direction: column; gap: 14px; }
.entry-card {
  background: var(--surface);
  border: 1px solid var(--border2);
  border-radius: var(--r-lg);
  padding: 24px 26px;
  position: relative;
  transition: all 0.25s;
  animation: fadeUp 0.4s ease forwards; opacity: 0;
  cursor: pointer;
}
.entry-card:hover {
  border-color: var(--border-rose);
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}
.entry-card-top {
  display: flex; align-items: center;
  justify-content: space-between; margin-bottom: 10px;
}
.entry-card-date { font-size: 0.67rem; color: var(--gold2); letter-spacing: 0.1em; }
.entry-card-mood { font-size: 0.72rem; color: var(--muted); font-style: italic; }
.entry-card-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.05rem; font-style: italic;
  margin-bottom: 8px; color: var(--cream);
}
.entry-card-preview {
  font-family: 'EB Garamond', serif;
  font-size: 0.96rem; color: var(--muted);
  line-height: 1.8;
  display: -webkit-box;
  -webkit-line-clamp: 3; -webkit-box-orient: vertical;
  overflow: hidden;
  transition: all 0.3s;
  white-space: pre-wrap;
}
.entry-card-preview.expanded {
  display: block;
  -webkit-line-clamp: unset;
  color: var(--cream2);
}
.entry-read-more {
  font-size: 0.7rem; color: var(--rose2);
  font-style: italic; margin-top: 10px;
  cursor: pointer; display: inline-block;
  transition: color 0.2s;
  background: none; border: none;
  font-family: 'Cormorant Garamond', serif;
  padding: 0;
}
.entry-read-more:hover { color: var(--rose3); }
.entry-del {
  position: absolute; top: 18px; right: 18px;
}

@media(max-width:600px){
  .lock-card { padding: 36px 24px; }
  .pin-dot { width: 46px; height: 46px; font-size: 1.3rem; }
}
</style>
</head>
<body>
<header class="topbar">
  <a href="index.html" class="topbar-logo">RincÃ³n de Lorena ğŸŒ¹</a>
  <nav class="topbar-nav">
    <a href="biblioteca.html" class="nav-link">ğŸ“š<span class="nav-text"> Libros</span></a>
    <a href="videos.html"    class="nav-link">ğŸ¬<span class="nav-text"> Videos</span></a>
    <a href="musica.html"    class="nav-link">ğŸµ<span class="nav-text"> MÃºsica</span></a>
    <a href="calendario.html" class="nav-link">ğŸ“…<span class="nav-text"> Agenda</span></a>
    <a href="diario.html"    class="nav-link active">ğŸ’­<span class="nav-text"> Diario</span></a>
    <a href="album.html"     class="nav-link">ğŸ–¼ï¸<span class="nav-text"> Ãlbum</span></a>
    <a href="wishlist.html"  class="nav-link">âœ¨<span class="nav-text"> Wishlist</span></a>
    <a href="mood.html"      class="nav-link">ğŸŒ™<span class="nav-text"> Mood</span></a>
    <a href="mascota.html" class="nav-link">ğŸ°<span class="nav-text"> Nesquik</span></a>
  </nav>
</header>

<div class="lock-wrap" id="lockWrap">
  <div class="lock-card">
    <span class="lock-icon">ğŸ”</span>
    <h2 class="lock-title">Diario <em>Privado</em></h2>
    <p class="lock-sub">Este espacio es solo tuyo ğŸŒ¹</p>
    <div class="pin-row">
      <input type="password" maxlength="1" class="pin-dot" id="p0" oninput="nextPin(0)" inputmode="numeric">
      <input type="password" maxlength="1" class="pin-dot" id="p1" oninput="nextPin(1)" inputmode="numeric">
      <input type="password" maxlength="1" class="pin-dot" id="p2" oninput="nextPin(2)" inputmode="numeric">
      <input type="password" maxlength="1" class="pin-dot" id="p3" oninput="nextPin(3)" inputmode="numeric">
    </div>
    <p class="pin-error" id="lockError">PIN incorrecto ğŸŒ¸</p>
    <button class="btn btn-rose" style="width:100%;justify-content:center" onclick="tryUnlock()">Entrar â†’</button>
    <p class="pin-hint">PIN por defecto: 1234</p>
  </div>
</div>

<div class="page diary-wrap" id="diaryView">
  <div class="diary-header">
    <div>
      <h1 class="pg-title">Mi <em>Diario</em> ğŸ’­</h1>
      <p class="pg-subtitle">Solo tus palabras, solo tuyo</p>
    </div>
    <div class="diary-actions">
      <button class="btn btn-ghost" onclick="changePIN()">ğŸ”‘ Cambiar PIN</button>
      <button class="btn btn-ghost" onclick="lockDiary()">ğŸ”’ Cerrar</button>
    </div>
  </div>

  <div class="new-entry">
    <div class="entry-dateline" id="newEntryDate"></div>
    <input type="text" class="entry-title-in" id="entryTitle" placeholder="TÃ­tulo de tu entrada...">
    <textarea class="entry-body-in" id="entryBody" placeholder="Â¿CÃ³mo te sientes hoy? Escribe lo que quieras..." rows="5"></textarea>
    <div class="entry-moods">
      <button class="mood-btn" onclick="selectMood(this)" data-mood="ğŸ˜Š Feliz">ğŸ˜Š Feliz</button>
      <button class="mood-btn" onclick="selectMood(this)" data-mood="ğŸ¥° Enamorada">ğŸ¥° Enamorada</button>
      <button class="mood-btn" onclick="selectMood(this)" data-mood="ğŸ˜´ Cansada">ğŸ˜´ Cansada</button>
      <button class="mood-btn" onclick="selectMood(this)" data-mood="ğŸ˜” Triste">ğŸ˜” Triste</button>
      <button class="mood-btn" onclick="selectMood(this)" data-mood="ğŸ˜¤ Enojada">ğŸ˜¤ Enojada</button>
      <button class="mood-btn" onclick="selectMood(this)" data-mood="ğŸŒ™ Reflexiva">ğŸŒ™ Reflexiva</button>
    </div>
    <div class="entry-foot">
      <button class="btn btn-rose" onclick="saveEntry()">Guardar entrada âœ¨</button>
    </div>
  </div>

  <div class="section-rule">Entradas anteriores</div>
  <div class="entries-list" id="entriesList"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
const app = initializeApp({
  apiKey:"AIzaSyA2YJXgAZAjOVqZ3eeTiMa9kCKaut_cA2w",
  authDomain:"lore-basedatos.firebaseapp.com",
  databaseURL:"https://lore-basedatos-default-rtdb.firebaseio.com",
  projectId:"lore-basedatos",
  storageBucket:"lore-basedatos.firebasestorage.app",
  messagingSenderId:"348470598297",
  appId:"1:348470598297:web:4634471f293f24a64fb608"
});
const db = getDatabase(app);
const DEFAULT_PIN = '1234';
let _entries = [];
let _mood = '';

function getPin(){ return localStorage.getItem('lore_diary_pin')||DEFAULT_PIN; }
async function loadEntries(){
  try{ const s=await get(ref(db,'diario/entries')); _entries=s.val()||[]; }
  catch{ _entries=[]; }
}
async function saveEntries(e){
  _entries=e;
  try{ await set(ref(db,'diario/entries'),e); }
  catch(err){ alert('Error al guardar. Revisa tu conexiÃ³n.'); }
}

window.nextPin=function(i){const v=document.getElementById(`p${i}`).value;if(v&&i<3)document.getElementById(`p${i+1}`).focus();}
window.tryUnlock=function(){
  const pin=[0,1,2,3].map(i=>document.getElementById(`p${i}`).value).join('');
  if(pin===getPin()){ unlock(); }
  else{
    document.getElementById('lockError').style.display='block';
    [0,1,2,3].forEach(i=>document.getElementById(`p${i}`).value='');
    document.getElementById('p0').focus();
  }
}
document.addEventListener('keydown',e=>{if(e.key==='Enter'&&document.getElementById('lockWrap').style.display!=='none')window.tryUnlock();});

async function unlock(){
  document.getElementById('lockWrap').style.display='none';
  const dv=document.getElementById('diaryView');
  dv.style.display='block';
  document.getElementById('newEntryDate').textContent=
    new Date().toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
  document.getElementById('entriesList').innerHTML='<div class="empty"><div class="e-icon">ğŸ’­</div><p>Cargando...</p></div>';
  await loadEntries();
  renderEntries();
}
window.lockDiary=function(){
  document.getElementById('lockWrap').style.display='flex';
  document.getElementById('diaryView').style.display='none';
  [0,1,2,3].forEach(i=>document.getElementById(`p${i}`).value='');
  document.getElementById('lockError').style.display='none';
}
window.changePIN=function(){
  const np=prompt('Nuevo PIN (4 dÃ­gitos):');
  if(np&&/^\d{4}$/.test(np)){localStorage.setItem('lore_diary_pin',np);alert('PIN actualizado ğŸŒ¹');}
  else if(np){alert('El PIN debe ser 4 nÃºmeros.');}
}
window.selectMood=function(btn){
  document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected'); _mood=btn.dataset.mood;
}
window.saveEntry=async function(){
  const title=document.getElementById('entryTitle').value.trim();
  const body=document.getElementById('entryBody').value.trim();
  if(!body)return;
  const btn=document.querySelector('.entry-foot .btn-rose');
  if(btn){btn.textContent='Guardando...';btn.disabled=true;}
  const entries=_entries.slice();
  entries.unshift({title:title||'Sin tÃ­tulo',body,mood:_mood,date:new Date().toISOString()});
  await saveEntries(entries);
  document.getElementById('entryTitle').value='';
  document.getElementById('entryBody').value='';
  document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('selected'));
  _mood='';
  if(btn){btn.textContent='Guardar entrada âœ¨';btn.disabled=false;}
  renderEntries();
}
window.deleteEntry=async function(i){
  if(!confirm('Â¿Eliminar esta entrada?'))return;
  const entries=_entries.slice(); entries.splice(i,1);
  await saveEntries(entries); renderEntries();
}
function renderEntries(){
  const list=document.getElementById('entriesList');
  if(!_entries.length){
    list.innerHTML='<div class="empty"><div class="e-icon">ğŸ’­</div><p>AÃºn no hay entradas. Â¡Empieza a escribir!</p></div>';
    return;
  }
  list.innerHTML=_entries.map((e,i)=>{
    const d=new Date(e.date);
    const ds=d.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
    const isLong = e.body.length > 200;
    return `<div class="entry-card" style="animation-delay:${i*0.06}s">
      <div class="entry-card-top">
        <span class="entry-card-date">ğŸ“… ${ds}</span>
        <span class="entry-card-mood">${e.mood||''}</span>
      </div>
      <div class="entry-card-title">${e.title}</div>
      <div class="entry-card-preview" id="ep${i}">${e.body}</div>
      ${isLong ? `<button class="entry-read-more" id="erm${i}" onclick="toggleEntry(${i})">Leer mÃ¡s â†’</button>` : ''}
      <button class="btn-icon entry-del" onclick="deleteEntry(${i})">âœ•</button>
    </div>`;
  }).join('');
}

window.toggleEntry = function(i) {
  const preview = document.getElementById('ep'+i);
  const btn = document.getElementById('erm'+i);
  const expanded = preview.classList.toggle('expanded');
  btn.textContent = expanded ? 'Leer menos â†‘' : 'Leer mÃ¡s â†’';
}
</script>
<script src="coco_widget.js"></script>
</body>
</html>