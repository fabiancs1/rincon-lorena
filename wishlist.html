<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wishlist ‚Äî Rinc√≥n de Lorena</title>
<link rel="stylesheet" href="lore.css">
<style>
:root{
  --bg:#06040c;--surface:#110e1a;--surface2:#181425;--surface3:#201b30;
  --cream:#f0e6d3;--muted:rgba(240,230,211,0.42);--muted2:rgba(240,230,211,0.22);
  --rose:#c8607f;--rose2:#e07898;--deep-rose:#8a3050;
  --gold:#b8942a;--gold2:#d4ae4a;
  --soft-gold:rgba(184,148,42,0.08);--border:rgba(184,148,42,0.12);--border-rose:rgba(200,96,127,0.16);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);font-family:'Cormorant Garamond',serif;color:var(--cream);min-height:100vh;overflow-x:hidden;}


/* TOPBAR */
.topbar{position:sticky;top:0;z-index:100;display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(13,8,16,0.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);}
.topbar-logo{font-family:'Playfair Display',serif;font-style:italic;color:var(--gold);font-size:1rem;text-decoration:none;}
.topbar-nav{display:flex;gap:2px;overflow-x:auto;}
.nav-link{color:var(--muted);font-size:0.78rem;padding:6px 12px;border-radius:20px;text-decoration:none;transition:all 0.2s;border:1px solid transparent;white-space:nowrap;}
.nav-link:hover{color:var(--cream);}
.nav-link.active{color:var(--gold);border-color:rgba(201,168,76,0.25);background:var(--soft-gold);}

/* PAGE */
.page-body{position:relative;z-index:1;max-width:1000px;margin:0 auto;padding:40px 20px 80px;}
.page-header{margin-bottom:28px;display:flex;align-items:flex-end;justify-content:space-between;flex-wrap:wrap;gap:16px;}
.page-header h1{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,5vw,2.6rem);}
.page-header h1 em{color:var(--rose);font-style:italic;}
.page-header p{color:var(--muted);font-style:italic;margin-top:6px;}
.btn-add{background:linear-gradient(135deg,var(--deep-rose),var(--rose));color:white;border:none;padding:10px 22px;border-radius:20px;font-family:'Cormorant Garamond',serif;font-size:0.95rem;cursor:pointer;transition:opacity 0.2s;}
.btn-add:hover{opacity:0.85;}

/* FILTERS */
.filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:26px;align-items:center;}
.filter-btn{background:none;border:1px solid var(--border);color:var(--muted);padding:7px 16px;border-radius:20px;font-family:'Cormorant Garamond',serif;font-size:0.85rem;cursor:pointer;transition:all 0.2s;white-space:nowrap;}
.filter-btn:hover{color:var(--cream);}
.filter-btn.active{color:var(--gold);border-color:rgba(201,168,76,0.35);background:var(--soft-gold);}
.filter-sep{width:1px;height:20px;background:var(--border);margin:0 4px;}
.stats{margin-left:auto;color:var(--muted);font-size:0.82rem;font-style:italic;}

/* GRID */
.wish-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;}

/* CARD */
.wish-card{background:var(--surface);border:1px solid var(--border);border-radius:18px;overflow:hidden;transition:transform 0.25s,border-color 0.25s;animation:fadeUp 0.4s ease forwards;opacity:0;position:relative;}
.wish-card:hover{transform:translateY(-3px);border-color:var(--border-rose);}
.wish-card.conseguido{border-color:rgba(201,168,76,0.3);}
.wish-card.conseguido .card-img-wrap::after{content:'‚ú® ¬°Conseguido!';position:absolute;inset:0;background:rgba(13,8,16,0.6);display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-style:italic;color:var(--gold);font-size:0.95rem;backdrop-filter:blur(2px);}

.card-img-wrap{position:relative;aspect-ratio:1;background:var(--surface2);overflow:hidden;}
.card-img-wrap img{width:100%;height:100%;object-fit:cover;display:block;transition:transform 0.4s;}
.wish-card:hover .card-img-wrap img{transform:scale(1.04);}
.card-img-placeholder{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:3rem;opacity:0.25;}

.card-body{padding:14px 16px 16px;}
.card-cat{font-size:0.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:5px;}
.card-name{font-family:'Playfair Display',serif;font-size:1rem;line-height:1.3;margin-bottom:6px;}
.card-price{color:var(--gold);font-size:0.9rem;font-style:italic;margin-bottom:12px;}
.card-price span{color:var(--muted);font-size:0.78rem;}

.card-actions{display:flex;gap:8px;}
.card-btn{flex:1;padding:8px 0;border-radius:12px;font-family:'Cormorant Garamond',serif;font-size:0.82rem;cursor:pointer;transition:all 0.2s;border:1px solid var(--border);background:none;color:var(--muted);}
.card-btn:hover{color:var(--cream);}
.card-btn.check{background:linear-gradient(135deg,var(--deep-rose),var(--rose));color:white;border-color:transparent;}
.card-btn.check:hover{opacity:0.85;}
.card-btn.uncheck{background:var(--soft-gold);color:var(--gold);border-color:rgba(201,168,76,0.2);}
.card-link{display:block;text-align:center;margin-top:8px;font-size:0.78rem;color:var(--muted);text-decoration:none;font-style:italic;transition:color 0.2s;}
.card-link:hover{color:var(--rose);}

.card-del{position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.6);color:rgba(255,255,255,0.7);border:none;width:26px;height:26px;border-radius:50%;cursor:pointer;font-size:0.7rem;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.2s;backdrop-filter:blur(4px);}
.wish-card:hover .card-del{opacity:1;}

/* EMPTY */
.empty-state{text-align:center;padding:60px 20px;color:var(--muted);grid-column:1/-1;}
.empty-state .icon{font-size:3rem;margin-bottom:14px;opacity:0.35;}
.empty-state p{font-style:italic;}

/* MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(5,2,8,0.9);backdrop-filter:blur(14px);z-index:400;align-items:center;justify-content:center;padding:20px;}
.modal-overlay.active{display:flex;}
.modal{background:var(--surface);border:1px solid var(--border-rose);border-radius:24px;padding:32px 28px;max-width:460px;width:100%;max-height:90vh;overflow-y:auto;}
.modal h3{font-family:'Playfair Display',serif;font-size:1.3rem;margin-bottom:4px;font-style:italic;}
.modal .modal-sub{color:var(--muted);font-size:0.85rem;font-style:italic;margin-bottom:24px;}
.modal label{display:block;font-size:0.82rem;color:var(--muted);margin-bottom:6px;margin-top:16px;}
.modal label:first-of-type{margin-top:0;}
.modal input,.modal select,.modal textarea{width:100%;background:var(--surface2);border:1px solid var(--border);color:var(--cream);padding:11px 14px;border-radius:12px;font-family:'Cormorant Garamond',serif;font-size:1rem;outline:none;transition:border-color 0.2s;resize:none;}
.modal input:focus,.modal select:focus,.modal textarea:focus{border-color:var(--border-rose);}
.modal input::placeholder,.modal textarea::placeholder{color:var(--muted);}
.modal select option{background:var(--surface2);}

/* IMAGE PREVIEW */
.img-preview{width:100%;height:140px;border-radius:12px;object-fit:cover;margin-top:10px;display:none;border:1px solid var(--border);}
.img-preview.visible{display:block;}
.img-source-tabs{display:flex;gap:6px;margin-bottom:10px;}
.img-tab{background:none;border:1px solid var(--border);color:var(--muted);padding:6px 14px;border-radius:12px;font-family:'Cormorant Garamond',serif;font-size:0.82rem;cursor:pointer;transition:all 0.2s;}
.img-tab.active{color:var(--gold);border-color:rgba(201,168,76,0.3);background:var(--soft-gold);}
.img-section{display:none;}
.img-section.active{display:block;}

.modal-btns{display:flex;gap:10px;justify-content:flex-end;margin-top:24px;}
.btn-cancel{background:none;border:1px solid var(--border);color:var(--muted);padding:10px 20px;border-radius:20px;font-family:'Cormorant Garamond',serif;font-size:0.95rem;cursor:pointer;}
.btn-save{background:linear-gradient(135deg,var(--deep-rose),var(--rose));color:white;border:none;padding:10px 26px;border-radius:20px;font-family:'Cormorant Garamond',serif;font-size:0.95rem;cursor:pointer;}

@keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
@keyframes pop{0%{transform:scale(1);}50%{transform:scale(1.08);}100%{transform:scale(1);}}
.pop{animation:pop 0.35s ease;}
@media(max-width:600px){.topbar-nav .nav-text{display:none;}.wish-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));}.stats{display:none;}}

body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(ellipse 80% 55% at -5% 0%,rgba(138,48,80,0.2) 0%,transparent 55%),
  radial-gradient(ellipse 55% 45% at 105% 105%,rgba(184,148,42,0.09) 0%,transparent 55%);}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;opacity:0.4;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");}
.page-body{animation:pgIn 0.45s ease;}@keyframes pgIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
::-webkit-scrollbar{width:3px;height:3px;}::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:rgba(184,148,42,0.2);border-radius:3px;}
.topbar{background:rgba(6,4,12,0.92)!important;backdrop-filter:blur(28px) saturate(1.4)!important;}
.topbar::after{content:'';position:absolute;bottom:0;left:5%;right:5%;height:1px;background:linear-gradient(90deg,transparent,rgba(184,148,42,0.12),transparent);}
.page-header h1 em{background:linear-gradient(135deg,#e07898,#f09ab8)!important;-webkit-background-clip:text!important;-webkit-text-fill-color:transparent!important;background-clip:text!important;}
.btn-save,.btn-add,.btn-action.primary,.btn-unlock{transition:all 0.25s!important;}
.btn-save:hover,.btn-add:hover,.btn-action.primary:hover{transform:translateY(-2px)!important;box-shadow:0 8px 28px rgba(138,48,80,0.4)!important;}
input:focus,textarea:focus{box-shadow:0 0 0 3px rgba(200,96,127,0.07)!important;}
.song-card,.book-card,.video-card,.entry-card,.event-item,.carta-item,.grid-card,.photo-item{transition:all 0.25s!important;}

</style>
</head>
<body>
<header class="topbar">
  <a href="index.html" class="topbar-logo">Rinc√≥n de Lorena üåπ</a>
  <nav class="topbar-nav">
    <a href="biblioteca.html" class="nav-link">üìö<span class="nav-text"> Libros</span></a>
    <a href="videos.html" class="nav-link">üé¨<span class="nav-text"> Videos</span></a>
    <a href="musica.html" class="nav-link">üéµ<span class="nav-text"> M√∫sica</span></a>
    <a href="calendario.html" class="nav-link">üìÖ<span class="nav-text"> Agenda</span></a>
    <a href="diario.html" class="nav-link">üí≠<span class="nav-text"> Diario</span></a>
    <a href="album.html" class="nav-link">üñºÔ∏è<span class="nav-text"> √Ålbum</span></a>
    <a href="wishlist.html" class="nav-link active">‚ú®<span class="nav-text"> Wishlist</span></a>
    <a href="mood.html" class="nav-link">üåô<span class="nav-text"> Mood</span></a>
  </nav>
</header>

<div class="page-body">
  <div class="page-header">
    <div>
      <h1>Tu <em>Wishlist</em> ‚ú®</h1>
      <p>Todo lo que deseas, en un solo lugar</p>
    </div>
    <button class="btn-add" onclick="openModal()">Ôºã Agregar deseo</button>
  </div>

  <div class="filters" id="filtersBar">
    <button class="filter-btn active" onclick="setFilter('todo',this)">Todo</button>
    <button class="filter-btn" onclick="setFilter('quiero',this)">üí´ Quiero</button>
    <button class="filter-btn" onclick="setFilter('conseguido',this)">‚úÖ Conseguido</button>
    <div class="filter-sep"></div>
    <button class="filter-btn" onclick="toggleCat('',this)" id="catAll" style="display:none">Todas las categor√≠as</button>
    <span class="stats" id="statsText"></span>
  </div>

  <div class="wish-grid" id="wishGrid"></div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h3>Agregar a la wishlist ‚ú®</h3>
    <p class="modal-sub">¬øQu√© tienes ganas de tener?</p>

    <label>Nombre del item *</label>
    <input type="text" id="nameInput" placeholder="Ej: Vestido floral verde, Libro de Julia Navarro..." maxlength="80">

    <label>Categor√≠a</label>
    <select id="catInput">
      <option value="Ropa">üëó Ropa</option>
      <option value="Zapatos">üë† Zapatos</option>
      <option value="Accesorios">üíç Accesorios</option>
      <option value="Belleza">üíÑ Belleza</option>
      <option value="Libros">üìö Libros</option>
      <option value="Hogar">üè† Hogar</option>
      <option value="Tecnolog√≠a">üì± Tecnolog√≠a</option>
      <option value="Otro">üå∏ Otro</option>
    </select>

    <label>Precio aproximado</label>
    <input type="text" id="precioInput" placeholder="Ej: $45.000 o $25 d√≥lares" maxlength="30">

    <label>Link de la tienda (opcional)</label>
    <input type="url" id="linkInput" placeholder="https://...">

    <label>Foto</label>
    <div class="img-source-tabs">
      <button class="img-tab active" onclick="switchImgTab('url',this)">üîó Link de imagen</button>
      <button class="img-tab" onclick="switchImgTab('upload',this)">üì∑ Subir foto</button>
    </div>
    <div class="img-section active" id="imgUrlSection">
      <input type="url" id="imgUrlInput" placeholder="https://... (pega el link de la imagen)" oninput="previewImgUrl()">
    </div>
    <div class="img-section" id="imgUploadSection">
      <input type="file" id="imgFileInput" accept="image/*" onchange="previewImgFile()">
    </div>
    <img id="imgPreview" class="img-preview" src="" alt="Preview">

    <label>Nota personal (opcional)</label>
    <textarea id="notaInput" placeholder="Ej: Lo vi en el Instagram de Zara, talla M..." rows="2" maxlength="120"></textarea>

    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal()">Cancelar</button>
      <button class="btn-save" onclick="guardar()">Guardar ‚ú®</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
const firebaseConfig = {
  apiKey: "AIzaSyA2YJXgAZAjOVqZ3eeTiMa9kCKaut_cA2w",
  authDomain: "lore-basedatos.firebaseapp.com",
  databaseURL: "https://lore-basedatos-default-rtdb.firebaseio.com",
  projectId: "lore-basedatos",
  storageBucket: "lore-basedatos.firebasestorage.app",
  messagingSenderId: "348470598297",
  appId: "1:348470598297:web:4634471f293f24a64fb608"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const IMGBB_KEY = "3dec58925d383bab2caebdbb0e2f43e0";

let items = [];
let currentFilter = 'todo';
let currentCat = '';

const CATS = ['Ropa','Zapatos','Accesorios','Belleza','Libros','Hogar','Tecnolog√≠a','Otro'];
const CAT_EMOJI = {Ropa:'üëó',Zapatos:'üë†',Accesorios:'üíç',Belleza:'üíÑ',Libros:'üìö',Hogar:'üè†','Tecnolog√≠a':'üì±',Otro:'üå∏'};

async function load() {
  try {
    const snap = await get(ref(db, 'wishlist/items'));
    items = snap.exists() ? snap.val() : [];
  } catch { items = []; }
  buildCatFilters();
  render();
}
async function save() { try { await set(ref(db, 'wishlist/items'), items); } catch(e) { console.error('Error guardando:', e); } }

function buildCatFilters() {
  const bar = document.getElementById('filtersBar');
  // Remove old cat filters
  bar.querySelectorAll('.cat-filter').forEach(el => el.remove());
  const usedCats = [...new Set(items.map(i => i.cat))].filter(Boolean);
  if (usedCats.length > 1) {
    const sep = document.createElement('div');
    sep.className = 'filter-sep cat-filter';
    bar.appendChild(sep);
    usedCats.forEach(cat => {
      const btn = document.createElement('button');
      btn.className = 'filter-btn cat-filter' + (currentCat === cat ? ' active' : '');
      btn.textContent = (CAT_EMOJI[cat]||'üå∏') + ' ' + cat;
      btn.onclick = () => toggleCat(cat, btn);
      bar.appendChild(btn);
    });
  }
  // stats
  const quiero = items.filter(i => i.estado === 'quiero').length;
  const conseguido = items.filter(i => i.estado === 'conseguido').length;
  document.getElementById('statsText').textContent = items.length ? `${quiero} pendiente${quiero!==1?'s':''} ¬∑ ${conseguido} conseguido${conseguido!==1?'s':''}` : '';
}

window.setFilter = function(f, el) {
  currentFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b => { if (!b.classList.contains('cat-filter')) b.classList.remove('active'); });
  el.classList.add('active');
  render();
}

window.toggleCat = function(cat, el) {
  currentCat = currentCat === cat ? '' : cat;
  document.querySelectorAll('.cat-filter.filter-btn').forEach(b => b.classList.remove('active'));
  if (currentCat) el.classList.add('active');
  render();
}

function render() {
  const grid = document.getElementById('wishGrid');
  let filtered = items;
  if (currentFilter !== 'todo') filtered = filtered.filter(i => i.estado === currentFilter);
  if (currentCat) filtered = filtered.filter(i => i.cat === currentCat);

  if (!filtered.length) {
    grid.innerHTML = `<div class="empty-state"><div class="icon">${items.length ? 'üîç' : '‚ú®'}</div><p>${items.length ? 'Nada aqu√≠ todav√≠a.' : '¬°Agrega tu primer deseo con el bot√≥n de arriba!'}</p></div>`;
    return;
  }
  grid.innerHTML = filtered.map((item, i) => {
    const delay = (i % 12) * 0.05;
    const conseguido = item.estado === 'conseguido';
    return `<div class="wish-card${conseguido?' conseguido':''}" style="animation-delay:${delay}s" id="card-${item.id}">
      <div class="card-img-wrap">
        ${item.img
          ? `<img src="${item.img}" alt="${item.name}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">`
          : ''}
        <div class="card-img-placeholder" style="${item.img?'display:none':'display:flex'}">${CAT_EMOJI[item.cat]||'üå∏'}</div>
      </div>
      <div class="card-body">
        <div class="card-cat">${item.cat || 'Otro'}</div>
        <div class="card-name">${item.name}</div>
        ${item.precio ? `<div class="card-price">${item.precio}</div>` : '<div style="height:4px"></div>'}
        ${item.nota ? `<div style="font-size:0.78rem;color:var(--muted);font-style:italic;margin-bottom:10px">${item.nota}</div>` : ''}
        <div class="card-actions">
          ${conseguido
            ? `<button class="card-btn uncheck" onclick="toggleEstado('${item.id}')">‚Ü© Desmarcar</button>`
            : `<button class="card-btn check" onclick="toggleEstado('${item.id}')">‚úì ¬°Lo consegu√≠!</button>`}
        </div>
        ${item.link ? `<a class="card-link" href="${item.link}" target="_blank" rel="noopener">üîó Ver en tienda ‚Üí</a>` : ''}
      </div>
      <button class="card-del" onclick="eliminar('${item.id}')">‚úï</button>
    </div>`;
  }).join('');
}

window.toggleEstado = function(id) {
  const item = items.find(i => i.id === id);
  if (!item) return;
  item.estado = item.estado === 'conseguido' ? 'quiero' : 'conseguido';
  save();
  buildCatFilters();
  render();
  // pop animation
  setTimeout(() => {
    const card = document.getElementById('card-' + id);
    if (card) { card.classList.add('pop'); setTimeout(() => card.classList.remove('pop'), 400); }
  }, 50);
}

window.eliminar = function(id) {
  if (!confirm('¬øEliminar este item?')) return;
  items = items.filter(i => i.id !== id);
  save(); buildCatFilters(); render();
}

// MODAL
let imgMode = 'url';
let pendingImgData = '';

window.openModal = function() {
  document.getElementById('modalOverlay').classList.add('active');
  setTimeout(() => document.getElementById('nameInput').focus(), 100);
}
window.closeModal = function() {
  document.getElementById('modalOverlay').classList.remove('active');
  ['nameInput','precioInput','linkInput','imgUrlInput','notaInput'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('imgFileInput').value = '';
  document.getElementById('imgPreview').classList.remove('visible');
  document.getElementById('imgPreview').src = '';
  pendingImgData = '';
}

window.switchImgTab = function(mode, el) {
  imgMode = mode;
  document.querySelectorAll('.img-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('imgUrlSection').classList.toggle('active', mode === 'url');
  document.getElementById('imgUploadSection').classList.toggle('active', mode === 'upload');
  document.getElementById('imgPreview').classList.remove('visible');
  pendingImgData = '';
}

window.previewImgUrl = function() {
  const url = document.getElementById('imgUrlInput').value.trim();
  const preview = document.getElementById('imgPreview');
  if (url) { preview.src = url; preview.classList.add('visible'); pendingImgData = url; }
  else { preview.classList.remove('visible'); pendingImgData = ''; }
}

window.previewImgFile = function() {
  const file = document.getElementById('imgFileInput').files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    pendingImgData = e.target.result; // base64 temporal para preview
    const preview = document.getElementById('imgPreview');
    preview.src = pendingImgData;
    preview.classList.add('visible');
  };
  reader.readAsDataURL(file);
}

async function uploadToImgBB(base64data) {
  const base64 = base64data.split(',')[1];
  const formData = new FormData();
  formData.append('image', base64);
  const res = await fetch(`https://api.imgbb.com/1/upload?key=3dec58925d383bab2caebdbb0e2f43e0`, {
    method: 'POST',
    body: formData
  });
  const json = await res.json();
  if (json.success) return json.data.url;
  throw new Error('ImgBB error');
}

window.guardar = async function() {
  const name = document.getElementById('nameInput').value.trim();
  if (!name) { document.getElementById('nameInput').style.borderColor = 'var(--rose)'; document.getElementById('nameInput').focus(); return; }
  document.getElementById('nameInput').style.borderColor = '';

  let imgFinal = imgMode === 'url' ? document.getElementById('imgUrlInput').value.trim() : '';

  // Si hay una imagen subida (base64), subirla a ImgBB
  if (pendingImgData && pendingImgData.startsWith('data:')) {
    const btnG = document.querySelector('.btn-save');
    if (btnG) { btnG.textContent = 'Subiendo imagen... ‚è≥'; btnG.disabled = true; }
    try {
      imgFinal = await uploadToImgBB(pendingImgData);
    } catch(e) {
      alert('Error subiendo la imagen. Intenta de nuevo üå∏');
      if (btnG) { btnG.textContent = 'Guardar ‚ú®'; btnG.disabled = false; }
      return;
    }
    if (btnG) { btnG.textContent = 'Guardar ‚ú®'; btnG.disabled = false; }
  } else if (pendingImgData) {
    imgFinal = pendingImgData;
  }

  items.unshift({
    id: Date.now() + '' + Math.floor(Math.random()*1000),
    name,
    cat: document.getElementById('catInput').value,
    precio: document.getElementById('precioInput').value.trim(),
    link: document.getElementById('linkInput').value.trim(),
    img: imgFinal,
    nota: document.getElementById('notaInput').value.trim(),
    estado: 'quiero',
    fecha: new Date().toISOString()
  });
  await save(); buildCatFilters(); closeModal(); render();
}

document.getElementById('nameInput').addEventListener('keydown', e => { if (e.key === 'Enter') guardar(); });
document.getElementById('modalOverlay').addEventListener('click', e => { if (e.target === document.getElementById('modalOverlay')) closeModal(); });

load();
</script>
</body>
</html>