<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda â€” RincÃ³n de Lorena</title>
<link rel="stylesheet" href="lore.css">
<style>
/* â”€â”€ CALENDAR NAV â”€â”€ */
.cal-nav-row {
  display: flex; align-items: center;
  justify-content: space-between; margin-bottom: 20px;
}
.cal-month-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.3rem; font-style: italic; color: var(--gold2);
}
.cal-arrow {
  background: var(--surface2); border: 1px solid var(--border);
  color: var(--gold2); width: 38px; height: 38px;
  border-radius: 50%; cursor: pointer;
  font-size: 1.1rem; transition: all 0.2s;
  display: flex; align-items: center; justify-content: center;
}
.cal-arrow:hover { background: var(--surface3); border-color: var(--border-rose); color: var(--rose2); }

/* â”€â”€ CALENDAR GRID â”€â”€ */
.cal-grid {
  display: grid; grid-template-columns: repeat(7,1fr);
  gap: 4px; margin-bottom: 28px;
}
.cal-header {
  text-align: center; font-size: 0.62rem;
  letter-spacing: 0.12em; text-transform: uppercase;
  color: var(--muted2); padding: 8px 0;
}
.cal-day {
  aspect-ratio: 1; border-radius: var(--r-sm);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  cursor: pointer; transition: all 0.2s;
  font-size: 0.86rem; position: relative;
  border: 1px solid transparent;
  color: var(--cream2);
}
.cal-day:hover { background: var(--surface2); border-color: var(--border); }
.cal-day.today {
  background: rgba(200,96,127,0.12);
  border-color: var(--border-rose);
  color: var(--rose2); font-weight: 600;
}
.cal-day.selected {
  background: var(--surface2); border-color: var(--rose);
}
.cal-day.has-event::after {
  content: ''; position: absolute; bottom: 5px;
  width: 4px; height: 4px; border-radius: 50%;
  background: var(--gold2);
  box-shadow: 0 0 6px rgba(212,174,74,0.6);
}
.cal-day.other-month { opacity: 0.2; cursor: default; }

/* â”€â”€ EVENTS PANEL â”€â”€ */
.events-panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--r-xl);
  padding: 26px 28px;
  box-shadow: var(--shadow);
}
.events-panel-title {
  font-family: 'Playfair Display', serif;
  font-size: 1rem; font-style: italic;
  margin-bottom: 18px; color: var(--cream);
}
.events-panel-title span { color: var(--rose2); }

.event-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; min-height: 40px; }
.event-item {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-radius: var(--r-md);
  padding: 12px 16px;
  display: flex; align-items: center; gap: 12px;
  transition: border-color 0.2s;
}
.event-item:hover { border-color: var(--border); }
.event-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.event-text { flex: 1; font-size: 0.9rem; color: var(--cream2); }
.event-empty { color: var(--muted); font-style: italic; font-size: 0.86rem; padding: 8px 0; }

.add-row {
  display: flex; gap: 10px; flex-wrap: wrap;
}
.add-row .input { flex: 1; min-width: 170px; }
.color-sel {
  background: var(--surface2); border: 1px solid var(--border);
  color: var(--cream); padding: 11px 12px;
  border-radius: var(--r-sm); font-family: 'Cormorant Garamond', serif;
  font-size: 0.9rem; outline: none; cursor: pointer;
}

@media(max-width:600px){
  .add-row { flex-direction: column; }
  .cal-day { font-size: 0.76rem; }
}
</style>
</head>
<body>
<header class="topbar">
  <a href="index.html" class="topbar-logo">RincÃ³n de Lorena ğŸŒ¹</a>
  <nav class="topbar-nav">
    <a href="biblioteca.html" class="nav-link">ğŸ“š<span class="nav-text"> Libros</span></a>
    <a href="videos.html"    class="nav-link">ğŸ¬<span class="nav-text"> Videos</span></a>
    <a href="musica.html"    class="nav-link">ğŸµ<span class="nav-text"> MÃºsica</span></a>
    <a href="calendario.html" class="nav-link active">ğŸ“…<span class="nav-text"> Agenda</span></a>
    <a href="diario.html"    class="nav-link">ğŸ’­<span class="nav-text"> Diario</span></a>
    <a href="album.html"     class="nav-link">ğŸ–¼ï¸<span class="nav-text"> Ãlbum</span></a>
    <a href="wishlist.html"  class="nav-link">âœ¨<span class="nav-text"> Wishlist</span></a>
    <a href="mood.html"      class="nav-link">ğŸŒ™<span class="nav-text"> Mood</span></a>
  </nav>
</header>

<div class="page">
  <div class="pg-head">
    <h1 class="pg-title">Tu <em>Agenda</em> ğŸ“…</h1>
    <p class="pg-subtitle">Eventos, recordatorios y fechas que importan</p>
  </div>

  <div class="cal-nav-row">
    <button class="cal-arrow" onclick="changeMonth(-1)">â€¹</button>
    <h2 class="cal-month-title" id="calTitle"></h2>
    <button class="cal-arrow" onclick="changeMonth(1)">â€º</button>
  </div>

  <div class="cal-grid" id="calGrid"></div>

  <div class="events-panel">
    <div class="events-panel-title">Eventos del <span id="selLabel">dÃ­a</span></div>
    <div class="event-list" id="eventList"></div>
    <div class="add-row">
      <input class="input" type="text" id="eventInput" placeholder="Agregar evento o recordatorio..." maxlength="80">
      <select class="color-sel" id="eventColor">
        <option value="#c8607f">ğŸŒ¸ Rosa</option>
        <option value="#b8942a">âœ¨ Dorado</option>
        <option value="#6090c8">ğŸ’™ Azul</option>
        <option value="#60a870">ğŸ’š Verde</option>
        <option value="#c89060">ğŸŠ Naranja</option>
      </select>
      <button class="btn btn-rose" onclick="addEvent()">ï¼‹ Agregar</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
const app = initializeApp({
  apiKey:"AIzaSyA2YJXgAZAjOVqZ3eeTiMa9kCKaut_cA2w",
  authDomain:"lore-basedatos.firebaseapp.com",
  databaseURL:"https://lore-basedatos-default-rtdb.firebaseio.com",
  projectId:"lore-basedatos",
  storageBucket:"lore-basedatos.firebasestorage.app",
  messagingSenderId:"348470598297",
  appId:"1:348470598297:web:4634471f293f24a64fb608"
});
const db = getDatabase(app);

const MONTHS=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
const DAYS=['Dom','Lun','Mar','MiÃ©','Jue','Vie','SÃ¡b'];
const cur=new Date();
let viewYear=cur.getFullYear(),viewMonth=cur.getMonth();
let selDate=`${cur.getFullYear()}-${String(cur.getMonth()+1).padStart(2,'0')}-${String(cur.getDate()).padStart(2,'0')}`;
let _events={};

async function load(){
  try{ const s=await get(ref(db,'calendario/events')); _events=s.val()||{}; }
  catch{ _events={}; }
  buildCal();
}
async function save(e){ _events=e; try{ await set(ref(db,'calendario/events'),e); }catch{} }

function buildCal(){
  document.getElementById('calTitle').textContent=`${MONTHS[viewMonth]} ${viewYear}`;
  const g=document.getElementById('calGrid');
  let h=DAYS.map(d=>`<div class="cal-header">${d}</div>`).join('');
  const first=new Date(viewYear,viewMonth,1).getDay();
  const dim=new Date(viewYear,viewMonth+1,0).getDate();
  const prev=new Date(viewYear,viewMonth,0).getDate();
  for(let i=0;i<first;i++) h+=`<div class="cal-day other-month">${prev-first+i+1}</div>`;
  for(let d=1;d<=dim;d++){
    const k=`${viewYear}-${String(viewMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isT=k===`${cur.getFullYear()}-${String(cur.getMonth()+1).padStart(2,'0')}-${String(cur.getDate()).padStart(2,'0')}`;
    const hasE=_events[k]&&_events[k].length>0;
    const isSel=k===selDate;
    h+=`<div class="cal-day${isT?' today':''}${hasE?' has-event':''}${isSel?' selected':''}" onclick="selectDay('${k}')">${d}</div>`;
  }
  const tot=first+dim; const rem=(7-tot%7)%7;
  for(let i=1;i<=rem;i++) h+=`<div class="cal-day other-month">${i}</div>`;
  g.innerHTML=h;
  renderEvents();
}
window.selectDay=function(k){ selDate=k; buildCal(); }
function renderEvents(){
  const evs=_events[selDate]||[];
  const parts=selDate.split('-');
  document.getElementById('selLabel').textContent=`${parseInt(parts[2])} de ${MONTHS[parseInt(parts[1])-1]}`;
  const list=document.getElementById('eventList');
  if(!evs.length){list.innerHTML='<p class="event-empty">Sin eventos para este dÃ­a âœ¨</p>';return;}
  list.innerHTML=evs.map((e,i)=>`
    <div class="event-item">
      <div class="event-dot" style="background:${e.color||'var(--rose)'}"></div>
      <span class="event-text">${e.text}</span>
      <button class="btn-icon" onclick="delEvent(${i})">âœ•</button>
    </div>`).join('');
}
window.addEvent=async function(){
  const inp=document.getElementById('eventInput');
  const txt=inp.value.trim(); if(!txt)return;
  const color=document.getElementById('eventColor').value;
  const ev={..._events}; if(!ev[selDate])ev[selDate]=[];
  ev[selDate].push({text:txt,color}); await save(ev);
  inp.value=''; buildCal();
}
window.delEvent=async function(i){
  const ev={..._events};
  if(ev[selDate]){ev[selDate].splice(i,1);if(!ev[selDate].length)delete ev[selDate];}
  await save(ev); buildCal();
}
window.changeMonth=function(d){ viewMonth+=d; if(viewMonth>11){viewMonth=0;viewYear++;}else if(viewMonth<0){viewMonth=11;viewYear--;} buildCal(); }
document.getElementById('eventInput').addEventListener('keydown',e=>{if(e.key==='Enter')window.addEvent();});
load();
</script>
</body>
</html>